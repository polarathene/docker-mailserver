(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{125:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return m}));var a=t(0),r=t.n(a);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=r.a.createContext({}),p=function(e){var n=r.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},u=function(e){var n=p(e.components);return r.a.createElement(s.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},d=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=p(t),d=a,m=u["".concat(i,".").concat(d)]||u[d]||b[d]||o;return t?r.a.createElement(m,l(l({ref:n},s),{},{components:t})):r.a.createElement(m,l({ref:n},s))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},84:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return p}));var a=t(3),r=t(7),o=(t(0),t(125)),i={id:"ldap-authentication",title:"LDAP authentication"},l={unversionedId:"ldap-authentication",id:"ldap-authentication",isDocsHomePage:!1,title:"LDAP authentication",description:"Introduction",source:"@site/docs/Configure-LDAP.md",slug:"/ldap-authentication",permalink:"/docker-mailserver/docs/ldap-authentication",editUrl:"https://github.com/polarathene/docker-mailserver/tree/docs/docusaurus-demo/website/docs/Configure-LDAP.md",version:"current"},c=[{value:"Introduction",id:"introduction",children:[]},{value:"List with the variables to control the container provisioning",id:"list-with-the-variables-to-control-the-container-provisioning",children:[]},{value:"Ldap Setup - Kopano/Zarafa",id:"ldap-setup---kopanozarafa",children:[]}],s={toc:c};function p(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h3",{id:"introduction"},"Introduction"),Object(o.b)("p",null,"Getting started with ldap and this mailserver we need to take 3 parts in account:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"POSTFIX"),Object(o.b)("li",{parentName:"ul"},"DOVECOT"),Object(o.b)("li",{parentName:"ul"},"SASLAUTHD (this can also be handled by dovecot above)")),Object(o.b)("h3",{id:"list-with-the-variables-to-control-the-container-provisioning"},"List with the variables to control the container provisioning"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"POSTFIX"),":"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"LDAP_QUERY_FILTER_USER")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"LDAP_QUERY_FILTER_GROUP")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"LDAP_QUERY_FILTER_ALIAS")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"LDAP_QUERY_FILTER_DOMAIN"))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"SASLAUTHD"),":"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"SASLAUTHD_LDAP_FILTER"))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"DOVECOT"),":"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"DOVECOT_USER_FILTER")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"DOVECOT_PASS_FILTER"))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"NOTE"),": This page will provide several use cases like recipes to show, how this project can be used with it's LDAP Features."),Object(o.b)("h3",{id:"ldap-setup---kopanozarafa"},"Ldap Setup - Kopano/Zarafa"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-yml"},'---\nversion: \'2\'\n\nservices:\n  mail:\n    image: tvial/docker-mailserver:latest\n    hostname: mail\n    domainname: domain.com\n    container_name: mail\n\n    ports:\n      - "25:25"\n      - "143:143"\n      - "587:587"\n      - "993:993"\n\n    volumes:\n      - maildata:/var/mail\n      - mailstate:/var/mail-state\n      - ./config/:/tmp/docker-mailserver/\n\n    environment:\n      # We are not using dovecot here\n      - SMTP_ONLY=1\n      - ENABLE_SPAMASSASSIN=1\n      - ENABLE_CLAMAV=1\n      - ENABLE_FAIL2BAN=1\n      - ENABLE_POSTGREY=1\n      - SASLAUTHD_PASSWD=      \n\n      # >>> SASL Authentication\n      - ENABLE_SASLAUTHD=1\n      - SASLAUTHD_LDAP_SERVER=<yourLdapContainer/yourLdapServer>\n      - SASLAUTHD_LDAP_PROTO=\n      - SASLAUTHD_LDAP_BIND_DN=cn=Administrator,cn=Users,dc=mydomain,dc=loc\n      - SASLAUTHD_LDAP_PASSWORD=mypassword\n      - SASLAUTHD_LDAP_SEARCH_BASE=dc=mydomain,dc=loc\n      - SASLAUTHD_LDAP_FILTER=(&(sAMAccountName=%U)(objectClass=person))\n      - SASLAUTHD_MECHANISMS=ldap\n      # <<< SASL Authentication\n\n      # >>> Postfix Ldap Integration\n      - ENABLE_LDAP=1\n      - LDAP_SERVER_HOST=<yourLdapContainer/yourLdapServer>\n      - LDAP_SEARCH_BASE=dc=mydomain,dc=loc\n      - LDAP_BIND_DN=cn=Administrator,cn=Users,dc=mydomain,dc=loc\n      - LDAP_BIND_PW=mypassword\n      - LDAP_QUERY_FILTER_USER=(&(objectClass=user)(mail=%s))\n      - LDAP_QUERY_FILTER_GROUP=(&(objectclass=group)(mail=%s))\n      - LDAP_QUERY_FILTER_ALIAS=(&(objectClass=user)(otherMailbox=%s))\n      - LDAP_QUERY_FILTER_DOMAIN=(&(|(mail=*@%s)(mailalias=*@%s)(mailGroupMember=*@%s))(mailEnabled=TRUE))\n      # <<< Postfix Ldap Integration\n\n      # >>> Kopano Integration\n      - ENABLE_POSTFIX_VIRTUAL_TRANSPORT=1\n      - POSTFIX_DAGENT=lmtp:kopano:2003\n      # <<< Kopano Integration\n\n      - ONE_DIR=1\n      - DMS_DEBUG=0\n      - SSL_TYPE=letsencrypt\n      - PERMIT_DOCKER=host\n\n    cap_add:\n      - NET_ADMIN\n\nvolumes:\n  maildata:\n    driver: local\n  mailstate:\n    driver: local\n')),Object(o.b)("p",null,"If your directory has not the postfix-book schema installed, then you must change the internal attribute handling for dovecot. For this you have to change the ",Object(o.b)("inlineCode",{parentName:"p"},"pass_attr")," and the ",Object(o.b)("inlineCode",{parentName:"p"},"user_attr")," mapping, as shown in the example below: "),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-yml"},"    - DOVECOT_PASS_ATTR=<YOUR_USER_IDENTIFYER_ATTRIBUTE>=user,<YOUR_USER_PASSWORD_ATTRIBUTE>=password\n    - DOVECOT_USER_ATTR=<YOUR_USER_HOME_DIRECTORY_ATTRIBUTE>=home,<YOUR_USER_MAILSTORE_ATTRIBUTE>=mail,<YOUR_USER_MAIL_UID_ATTRIBUTE>=uid, <YOUR_USER_MAIL_GID_ATTRIBUTE>=gid\n")),Object(o.b)("p",null,"The following example illustrates this for a directory that has the qmail-schema installed and that uses ",Object(o.b)("inlineCode",{parentName:"p"},"uid"),":"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-yml"},"      - DOVECOT_PASS_ATTRS=uid=user,userPassword=password\n      - DOVECOT_USER_ATTRS=homeDirectory=home,qmailUID=uid,qmailGID=gid,mailMessageStore=mail\n      - DOVECOT_PASS_FILTER=(&(objectClass=qmailUser)(uid=%u)(accountStatus=active))\n      - DOVECOT_USER_FILTER=(&(objectClass=qmailUser)(uid=%u)(accountStatus=active))\n")))}p.isMDXComponent=!0}}]);