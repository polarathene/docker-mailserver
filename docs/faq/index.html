<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/docker-mailserver/blog/rss.xml" title="Docker Mailserver Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docker-mailserver/blog/atom.xml" title="Docker Mailserver Blog Atom Feed"><title data-react-helmet="true">FAQ and Tips | Docker Mailserver</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="FAQ and Tips | Docker Mailserver"><meta data-react-helmet="true" name="description" content="What kind of database are you using?"><meta data-react-helmet="true" property="og:description" content="What kind of database are you using?"><meta data-react-helmet="true" property="og:url" content="https://polarathene.github.io/docker-mailserver/docs/faq"><link data-react-helmet="true" rel="shortcut icon" href="/docker-mailserver/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://polarathene.github.io/docker-mailserver/docs/faq"><link rel="stylesheet" href="/docker-mailserver/styles.412d942f.css">
<link rel="preload" href="/docker-mailserver/styles.d864945f.js" as="script">
<link rel="preload" href="/docker-mailserver/runtime~main.f1b5c049.js" as="script">
<link rel="preload" href="/docker-mailserver/main.428bc413.js" as="script">
<link rel="preload" href="/docker-mailserver/1.f37643b9.js" as="script">
<link rel="preload" href="/docker-mailserver/2.156766f6.js" as="script">
<link rel="preload" href="/docker-mailserver/55.abd3ce97.js" as="script">
<link rel="preload" href="/docker-mailserver/56.54fdbbae.js" as="script">
<link rel="preload" href="/docker-mailserver/935f2afb.5d2e2556.js" as="script">
<link rel="preload" href="/docker-mailserver/17896441.06341064.js" as="script">
<link rel="preload" href="/docker-mailserver/bdc4edb4.38835913.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docker-mailserver/"><img src="/docker-mailserver/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/docker-mailserver/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docker Mailserver</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docker-mailserver/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/polarathene/docker-mailserver" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docker-mailserver/"><img src="/docker-mailserver/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/docker-mailserver/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docker Mailserver</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docker-mailserver/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/polarathene/docker-mailserver" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docker-mailserver/docs/">Home</a></li><li class="menu__list-item"><a class="menu__link" href="/docker-mailserver/docs/introduction">An Introduction to Mail Servers</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker-mailserver/docs/setupsh">Your best friend setup.sh</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">User Management</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-accounts">Configure Accounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-aliases">Configure Aliases</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-dkim">Configure DKIM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-dmarc">Configure DMARC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-spf">Configure SPF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-autodiscover">Autodiscovery</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/understanding-ports">Understanding the ports</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-ssl">SSL/TLS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-fail2ban">Configure Fail2Ban</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">When something went wrong</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker-mailserver/docs/debugging">Debugging</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docker-mailserver/docs/faq">FAQ and Tips</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker-mailserver/docs/config-pop3">Mail delivery with POP3</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/optional-configuration">Optional Configuration</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Maintenance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/update-and-cleanup">Update &amp; Cleanup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Override the default config of</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/override-dovecot">Override the default config of Dovecot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/override-postfix">Override the default config of Postfix</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/email-sieve">Email filtering with Sieve Filters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/email-fetchmail">Email gathering with fetchmail</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Email forwarding with</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/email-forward-relayhosts">Email forwarding with Relay Hosts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/email-forward-awsses">Email forwarding with AWS SES</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/fulltext-search">Full-text Search</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/kubernetes">Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/ipv6">IPv6</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docker-mailserver/docs/faq">FAQ and Tips</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker-mailserver/docs/install-examples">Installation Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Use Cases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/usecase-forwardonly-ldap-auth">Forward-Only mailserver with LDAP authentication</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">FAQ and Tips</h1></header><div class="markdown"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-kind-of-database-are-you-using"></a>What kind of database are you using?<a class="hash-link" href="#what-kind-of-database-are-you-using" title="Direct link to heading">#</a></h3><p>None! No database is required. Filesystem is the database.<br>
This image is based on config files that can be persisted using Docker volumes, and as such versioned, backed up and so forth.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="where-are-emails-stored"></a>Where are emails stored?<a class="hash-link" href="#where-are-emails-stored" title="Direct link to heading">#</a></h3><p>Mails are stored in <code>/var/mail/${domain}/${username}</code>.<br>
You should use a <a href="https://medium.com/@ramangupta/why-docker-data-containers-are-good-589b3c6c749e#.uxyrp7xpu" target="_blank" rel="noopener noreferrer">data volume container</a> for <code>/var/mail</code> to persist data. Otherwise, your data may be lost.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-to-alter-the-running-mailserver-instance-without-relaunching-the-container"></a>How to alter the running mailserver instance <em>without</em> relaunching the container?<a class="hash-link" href="#how-to-alter-the-running-mailserver-instance-without-relaunching-the-container" title="Direct link to heading">#</a></h3><p>docker-mailserver aggregates multiple &quot;sub-services&quot;, such as Postfix, Dovecot, Fail2ban, SpamAssasin, etc.  In many cases, on may edit a sub-service&#x27;s config and reload that very sub-service, without stopping and relaunching the whole mail server.</p><p>In order to do so, you&#x27;ll probably want to push your config updates to your server through a Docker volume, then restart the sub-service to apply your changes, using <code>supervisorctl</code>. For instance, after editing fail2ban&#x27;s config: <code>supervisorctl restart fail2ban</code>.</p><p>See <a href="http://supervisord.org/running.html#running-supervisorctl" target="_blank" rel="noopener noreferrer">supervisorctl&#x27;s documentation</a>.</p><p>Tips: to add/update/delete an email account, there is no need to restart postfix/dovecot service inside the container after using setup.sh script.
For more information, see <a href="https://github.com/tomav/docker-mailserver/issues/1639" target="_blank" rel="noopener noreferrer">issues/1639</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-can-i-sync-container-with-host-datetime-timezone"></a>How can I sync container with host date/time? Timezone?<a class="hash-link" href="#how-can-i-sync-container-with-host-datetime-timezone" title="Direct link to heading">#</a></h3><p>Share the host&#x27;s <a href="https://www.freedesktop.org/software/systemd/man/localtime.html" target="_blank" rel="noopener noreferrer"><code>/etc/localtime</code></a> with the docker-mailserver container, using a Docker volume:  </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - /etc/localtime:/etc/localtime:ro</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>(optional) Add one line to <code>.env</code> or <code>env-mailserver</code> to set timetzone for container, for example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">TZ=Europe/Berlin</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>check here for <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener noreferrer"><code>tz name list</code></a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-is-the-file-format"></a>What is the file format?<a class="hash-link" href="#what-is-the-file-format" title="Direct link to heading">#</a></h3><p>All files are using the Unix format with <code>LF</code> line endings.
Please do not use <code>CRLF</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-about-backups"></a>What about backups?<a class="hash-link" href="#what-about-backups" title="Direct link to heading">#</a></h3><p>Assuming that you use <code>docker-compose</code> and a data volumes, you can backup your user mails like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --rm -ti \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -v maildata:/var/mail \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -v mailstate:/var/mail-state \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -v /backup/mail:/backup \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  alpine:3.2 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  tar czf /backup/mail-`date +%y%m%d-%H%M%S`.tgz /var/mail /var/mail-state</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">find /backup/mail -type f -mtime +30 -exec rm -f {} \;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-about-mail-state-folder"></a>What about <code>mail-state</code> folder?<a class="hash-link" href="#what-about-mail-state-folder" title="Direct link to heading">#</a></h3><p>This folder consolidates all data generated by the server itself to persist when you upgrade.
Example of data folder persisted: lib-amavis, lib-clamav, lib-fail2ban, lib-postfix, lib-postgrey, lib-spamassasin, lib-spamassassin, spool-postfix, ...</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-can-i-configure-my-email-client"></a>How can I configure my email client?<a class="hash-link" href="#how-can-i-configure-my-email-client" title="Direct link to heading">#</a></h3><p>Login are full email address (<code>user@domain.com</code>).  </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># imap</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">username:           &lt;user1@domain.tld&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">password:           &lt;mypassword&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">server:             &lt;mail.domain.tld&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">imap port:          143 or 993 with ssl (recommended)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">imap path prefix:   INBOX</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># smtp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">smtp port:          25 or 587 with ssl (recommended)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">username:           &lt;user1@domain.tld&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">password:           &lt;mypassword&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Please use <code>STARTTLS</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-can-i-manage-my-custom-spamassassin-rules"></a>How can I manage my custom Spamassassin rules?<a class="hash-link" href="#how-can-i-manage-my-custom-spamassassin-rules" title="Direct link to heading">#</a></h3><p>Antispam rules are managed in <code>config/spamassassin-rules.cf</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-are-acceptable-sa_spam_subject-values"></a>What are acceptable <code>SA_SPAM_SUBJECT</code> values?<a class="hash-link" href="#what-are-acceptable-sa_spam_subject-values" title="Direct link to heading">#</a></h3><p>For no subject set <code>SA_SPAM_SUBJECT=undef</code>.</p><p>For a trailing white-space subject one can define the whole variable with quotes in <code>docker-compose.yml</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-docker-compose codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;SA_SPAM_SUBJECT=[SPAM] &quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="can-i-use-nakedbare-domains-no-host-name"></a>Can I use naked/bare domains (no host name)?<a class="hash-link" href="#can-i-use-nakedbare-domains-no-host-name" title="Direct link to heading">#</a></h3><p>Yes, but not without some configuration changes. Normally it is assumed that docker-mailserver runs on a host with a name, so the fully qualified host name might be <code>mail.example.com</code> with the domain <code>example.com</code>. The MX records point to <code>mail.example.com</code>. To use a bare domain where the host name is <code>example.com</code> and the domain is also <code>example.com</code>, change mydestination from:</p><p><code>mydestination = $myhostname, localhost.$mydomain, localhost</code></p><p>To:</p><p><code>mydestination = localhost.$mydomain, localhost</code></p><p>Add the latter line to config/postfix-main.cf. That should work. Without that change there will be warnings in the logs like:</p><p><code>warning: do not list domain example.com in BOTH mydestination and virtual_mailbox_domains</code></p><p>Plus of course mail delivery fails.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="why-are-spamassassin-x-headers-not-inserted-into-my-sampledomaincom-subdomain-emails"></a>Why are Spamassassin x-headers not inserted into my sample.domain.com subdomain emails?<a class="hash-link" href="#why-are-spamassassin-x-headers-not-inserted-into-my-sampledomaincom-subdomain-emails" title="Direct link to heading">#</a></h3><p>In the default setup, amavis only applies Spamassassin x-headers into domains matching the template listed in the config  file 05-domain_id (in the amavis defaults). The default setup @local_domains_acl = ( &quot;.$mydomain&quot; ); does not match subdomains. To match subdomains, you can override the @local_domains_acl directive in the amavis user config file 50-user with @local_domains_maps = (&quot;.&quot;); to match any sort of domain template. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-can-i-make-spamassassin-learn-spam"></a>How can I make SpamAssassin learn spam?<a class="hash-link" href="#how-can-i-make-spamassassin-learn-spam" title="Direct link to heading">#</a></h3><p>Put received spams in <code>.Junk/</code> imap folder using <code>SPAMASSASSIN_SPAM_TO_INBOX=1</code> and <code>MOVE_SPAM_TO_JUNK=1</code> and add a <em>user</em> cron like the following:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This assumes you&#x27;re having `environment: ONE_DIR=1` in the env-mailserver,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># with a consolidated config in `/var/mail-state`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># m h dom mon dow command</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Everyday 2:00AM, learn spam from a specific user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0 2 * * * docker exec mail sa-learn --spam /var/mail/domain.com/username/.Junk --dbpath /var/mail-state/lib-amavis/.spamassassin</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If you run the server with docker-compose, you can leverage on docker configs and the mailserver&#x27;s own cron. This is less problematic than the simple solution shown above, because it decouples the learning from the host on which the mailserver is running and avoids errors if the server is not running. </p><p>The following configuration works nicely:</p><p>create a <em>system</em> cron file:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># in the docker-compose.yml root directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir cron</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">touch cron/sa-learn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">chown root:root cron/sa-learn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">chmod 0644 cron/sa-learn</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>edit the system cron file <code>nano cron/sa-learn</code>, and set an appropriate configuration:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This assumes you&#x27;re having `environment: ONE_DIR=1` in the env-mailserver,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># with a consolidated config in `/var/mail-state`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># m h dom mon dow user command</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Everyday 2:00AM, learn spam from a specific user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># spam: junk directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0  2 * * * root  sa-learn --spam /var/mail/domain.com/username/.Junk --dbpath /var/mail-state/lib-amavis/.spamassassin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ham: archive directories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">15 2 * * * root  sa-learn --ham /var/mail/domain.com/username/.Archive* --dbpath /var/mail-state/lib-amavis/.spamassassin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ham: inbox subdirectories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">30 2 * * * root  sa-learn --ham /var/mail/domain.com/username/cur* --dbpath /var/mail-state/lib-amavis/.spamassassin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Everyday 3:00AM, learn spam from all users of a domain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># spam: junk directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">0  3 * * * root  sa-learn --spam /var/mail/otherdomain.com/*/.Junk --dbpath /var/mail-state/lib-amavis/.spamassassin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ham: archive directories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">15 3 * * * root  sa-learn --ham /var/mail/otherdomain.com/*/.Archive* --dbpath /var/mail-state/lib-amavis/.spamassassin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># ham: inbox subdirectories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">30 3 * * * root  sa-learn --ham /var/mail/otherdomain.com/*/cur* --dbpath /var/mail-state/lib-amavis/.spamassassin</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>with plain docker-compose:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-docker-compose codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">version: &quot;2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  mail:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: tvial/docker-mailserver:latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - ./cron/sa-learn:/etc/cron.d/sa-learn</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>with <a href="https://docs.docker.com/engine/swarm/configs/" target="_blank" rel="noopener noreferrer">docker swarm</a>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-docker-compose codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">version: &quot;3.3&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  mail:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: tvial/docker-mailserver:latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    configs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - source: my_sa_crontab</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        target: /etc/cron.d/sa-learn</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">configs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  my_sa_crontab:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    file: ./cron/sa-learn</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>With the default settings, Spamassassin will require 200 mails trained for spam (for example with the method explained above) and 200 mails trained for ham (using the same command as above but using <code>--ham</code> and providing it with some ham mails). Until you provided these 200+200 mails, Spamassasin will not take the learned mails into account. For further reference, see the <a href="https://wiki.apache.org/spamassassin/BayesNotWorking" target="_blank" rel="noopener noreferrer">Spamassassin Wiki</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-can-i-configure-a-catch-all"></a>How can I configure a catch-all?<a class="hash-link" href="#how-can-i-configure-a-catch-all" title="Direct link to heading">#</a></h3><p>Considering you want to redirect all incoming e-mails for the domain <code>domain.tld</code> to <code>user1@domain.tld</code>, add the following line to <code>config/postfix-virtual.cf</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@domain.tld user1@domain.tld</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-can-i-delete-all-the-e-mails-for-a-specific-user"></a>How can I delete all the e-mails for a specific user?<a class="hash-link" href="#how-can-i-delete-all-the-e-mails-for-a-specific-user" title="Direct link to heading">#</a></h3><p>First of all, create a special alias named <code>devnull</code> by editing <code>config/postfix-aliases.cf</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">devnull:    /dev/null</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Considering you want to delete all the e-mails received for <code>baduser@domain.tld</code>, add the following line to <code>config/postfix-virtual.cf</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">baduser@domain.tld  devnull</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-do-i-have-more-control-about-what-spamassasin-is-filtering"></a>How do I have more control about what SPAMASSASIN is filtering?<a class="hash-link" href="#how-do-i-have-more-control-about-what-spamassasin-is-filtering" title="Direct link to heading">#</a></h3><p>By default, SPAM and INFECTED emails are put to a quarantine which is not very straight forward to access. Several config settings are affecting this behavior:</p><p>First, make sure you have the proper thresholds set:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SA_TAG=-100000.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SA_TAG2=3.75</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SA_KILL=100000.0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The very negative vaue in <code>SA_TAG</code> makes sure, that all emails have the Spamassasin headers included.
<code>SA_TAG2</code> is the actual threshold to set the YES/NO flag for spam detection.
<code>SA_KILL</code> needs to be very high, to make sure nothing is bounced at all (<code>SA_KILL</code> superseeds <code>SPAMASSASSIN_SPAM_TO_INBOX</code>)</p><p>Make sure everything (including SPAM) is delivered to the inbox and not quarantined.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">SPAMASSASSIN_SPAM_TO_INBOX=1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Use <code>MOVE_SPAM_TO_JUNK=1</code> or create a sieve script which puts spam to the Junk folder.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">require [&quot;comparator-i;ascii-numeric&quot;,&quot;relational&quot;,&quot;fileinto&quot;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if header :contains &quot;X-Spam-Flag&quot; &quot;YES&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  fileinto &quot;Junk&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">} elsif allof (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   not header :matches &quot;x-spam-score&quot; &quot;-*&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   header :value &quot;ge&quot; :comparator &quot;i;ascii-numeric&quot; &quot;x-spam-score&quot; &quot;3.75&quot; ) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  fileinto &quot;Junk&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Create a dedicated mailbox for emails which are infected/bad header and everything amavis is blocking by default and put its address into <code>config/amavis.cf</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$clean_quarantine_to      = &quot;amavis\@domain.com&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$virus_quarantine_to      = &quot;amavis\@domain.com&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$banned_quarantine_to     = &quot;amavis\@domain.com&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$bad_header_quarantine_to = &quot;amavis\@domain.com&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$spam_quarantine_to       = &quot;amavis\@domain.com&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-kind-of-ssl-certificates-can-i-use"></a>What kind of SSL certificates can I use?<a class="hash-link" href="#what-kind-of-ssl-certificates-can-i-use" title="Direct link to heading">#</a></h3><p>You can use the same certificates you use with another mail server.<br>
The only thing is that we provide a <code>self-signed</code> certificate tool and a <code>letsencrypt</code> certificate loader.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="i-just-moved-from-my-old-mail-server-but-it-doesnt-work"></a>I just moved from my old mail server but &quot;it doesn&#x27;t work&quot;.<a class="hash-link" href="#i-just-moved-from-my-old-mail-server-but-it-doesnt-work" title="Direct link to heading">#</a></h3><p>If this migration implies a DNS modification, be sure to wait for DNS propagation before opening an issue.
Few examples of symptoms can be found <a href="https://github.com/tomav/docker-mailserver/issues/95" target="_blank" rel="noopener noreferrer">here</a> or <a href="https://github.com/tomav/docker-mailserver/issues/97" target="_blank" rel="noopener noreferrer">here</a>.<br>
This could be related to a modification of your <code>MX</code> record, or the IP mapped to <code>mail.my-domain.tld</code>. Additionally, <a href="https://intodns.com/" target="_blank" rel="noopener noreferrer">validate your DNS configuration</a>. </p><p>If everything is OK regarding DNS, please provide <a href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="noopener noreferrer">formatted logs</a> and config files. This will allow us to help you.</p><p>If we&#x27;re blind, we won&#x27;t be able to do anything.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="which-system-requirements-needs-my-container-to-run-docker-mailserver-effectively"></a>Which system requirements needs my container to run <code>docker-mailserver</code> effectively?<a class="hash-link" href="#which-system-requirements-needs-my-container-to-run-docker-mailserver-effectively" title="Direct link to heading">#</a></h3><p>1 core and 1GB of RAM + swap partition is recommended to run <code>docker-mailserver</code> with clamav.
Otherwise, it could work with 512M of RAM.</p><p>Please note that clamav can consume a lot of memory, as it reads the entire signature database into RAM. Current figure is about 850M and growing. If you get errors about clamav or amavis failing to allocate memory you need more RAM or more swap and of course docker must be allowed to use swap (not always the case). If you can&#x27;t use swap at all you may need 3G RAM.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="is-docker-mailserver-running-in-a-rancher-environment"></a>Is <code>docker-mailserver</code> running in a <a href="http://rancher.com/rancher/" target="_blank" rel="noopener noreferrer">rancher environment</a>?<a class="hash-link" href="#is-docker-mailserver-running-in-a-rancher-environment" title="Direct link to heading">#</a></h3><p>Yes, by Adding the Environment Variable <code>PERMIT_DOCKER: network</code>.</p><p><strong>WARNING</strong>: Adding the docker network&#x27;s gateway to the list of trusted hosts, e.g. using the <code>network</code> or <code>connected-networks</code> option, can create an <a href="https://en.wikipedia.org/wiki/Open_mail_relay" target="_blank" rel="noopener noreferrer"><strong>open relay</strong></a>, <a href="https://github.com/tomav/docker-mailserver/issues/1405#issuecomment-590106498" target="_blank" rel="noopener noreferrer">for instance</a> if IPv6 is enabled on the host machine but not in Docker. (<a href="https://github.com/tomav/docker-mailserver/issues/1405" target="_blank" rel="noopener noreferrer">#1405</a>)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-can-i-authenticate-users-with-smtp_only"></a>How can I authenticate users with SMTP_ONLY?<a class="hash-link" href="#how-can-i-authenticate-users-with-smtp_only" title="Direct link to heading">#</a></h3><p>See <a href="https://github.com/tomav/docker-mailserver/issues/1247" target="_blank" rel="noopener noreferrer">https://github.com/tomav/docker-mailserver/issues/1247</a> for an example.</p><p><em>ToDo: Write a HowTo/UseCase/Tutorial about authentication with SMTP_ONLY.</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="common-errors"></a>Common errors<a class="hash-link" href="#common-errors" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">warning: connect to Milter service inet:localhost:8893: Connection refused</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># DMARC not running</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># =&gt; /etc/init.d/opendmarc restart</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">warning: connect to Milter service inet:localhost:8891: Connection refused</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># DKIM not running</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># =&gt; /etc/init.d/opendkim restart</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mail amavis[1459]: (01459-01) (!)connect to /var/run/clamav/clamd.ctl failed, attempt #1: Can&#x27;t connect to a UNIX socket /var/run/clamav/clamd.ctl: No such file or directory</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mail amavis[1459]: (01459-01) (!)ClamAV-clamd: All attempts (1) failed connecting to /var/run/clamav/clamd.ctl, retrying (2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mail amavis[1459]: (01459-01) (!)ClamAV-clamscan av-scanner FAILED: /usr/bin/clamscan KILLED, signal 9 (0009) at (eval 100) line 905.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">mail amavis[1459]: (01459-01) (!!)AV: ALL VIRUS SCANNERS FAILED</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Clamav is not running (not started or because you don&#x27;t have enough memory)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># =&gt; check requirements and/or start Clamav</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-behind-proxy"></a>Using behind proxy<a class="hash-link" href="#using-behind-proxy" title="Direct link to heading">#</a></h3><p>Add to <code>/etc/postfix/main.cf</code> :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">proxy_interfaces = X.X.X.X (your public IP) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-about-updates"></a>What about updates<a class="hash-link" href="#what-about-updates" title="Direct link to heading">#</a></h3><p>You can of course use a own script or every now and then pull &amp;&amp; stop &amp;&amp; rm &amp;&amp; start the images but there are tools available for this.
There is a page in the <a href="/docker-mailserver/docs/Update-and-cleanup">Update and cleanup</a> wiki page that explains how to use it the docker way.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="howto-adjust-settings-with-the-user-patchessh-script"></a>Howto adjust settings with the user-patches.sh script<a class="hash-link" href="#howto-adjust-settings-with-the-user-patchessh-script" title="Direct link to heading">#</a></h3><p>Suppose you want to change a number of settings that are not listed as variables or add things to the server that are not included?</p><p>This docker-container has a built-in way to do post-install processes. If you place a script called <strong>user-patches.sh</strong> in the config directory it will be run after all configuration files are set up, but before the postfix, amavis and other daemons are started.</p><p>The config file I am talking about is this volume in the yml file: </p><p><code>- ./config/:/tmp/docker-mailserver/</code></p><p>To place such a script you can just make it in the config dir, for instance like this:</p><p><code>cd ./config</code></p><p><code>touch user-patches.sh</code></p><p><code>chmod +x  user-patches.sh</code></p><p>and then fill it with suitable code. </p><p>If you want to test it you can move into the running container, run it and see if it does what you want. For instance:</p><p><code>./setup.sh debug login    # start shell in container</code></p><p><code>cat /tmp/docker-mailserver/user-patches.sh  #check the file</code></p><p><code>/tmp/docker-mailserver/user-patches.sh  ## run the script</code></p><p><code>exit</code></p><p>You can do a lot of things with such a script. You can find an example user-patches.sh script here: <a href="https://github.com/hanscees/dockerscripts/blob/master/scripts/tomav-user-patches.sh" target="_blank" rel="noopener noreferrer">example user-patches.sh script</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="special-case-patching-supervisord-config"></a>Special case patching supervisord config<a class="hash-link" href="#special-case-patching-supervisord-config" title="Direct link to heading">#</a></h4><p>It seems worth noting, that the <code>user-patches.sh</code> gets executed trough supervisord. If you need to patch some supervisord config (e.g. <code>/etc/supervisor/conf.d/saslauth.conf</code>), the patching happens too late.
An easy workaround is to make the <code>user-patches.sh</code> reload the supervisord config after patching it:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;s/rimap -r/rimap/&#x27;</span><span class="token plain"> /etc/supervisor/conf.d/saslauth.conf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">supervisorctl update</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/polarathene/docker-mailserver/tree/docs/docusaurus-demo/website/docs/FAQ-and-Tips.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docker-mailserver/docs/debugging"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Debugging</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docker-mailserver/docs/config-pop3"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mail delivery with POP3 Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-kind-of-database-are-you-using" class="table-of-contents__link">What kind of database are you using?</a></li><li><a href="#where-are-emails-stored" class="table-of-contents__link">Where are emails stored?</a></li><li><a href="#how-to-alter-the-running-mailserver-instance-without-relaunching-the-container" class="table-of-contents__link">How to alter the running mailserver instance <em>without</em> relaunching the container?</a></li><li><a href="#how-can-i-sync-container-with-host-datetime-timezone" class="table-of-contents__link">How can I sync container with host date/time? Timezone?</a></li><li><a href="#what-is-the-file-format" class="table-of-contents__link">What is the file format?</a></li><li><a href="#what-about-backups" class="table-of-contents__link">What about backups?</a></li><li><a href="#what-about-mail-state-folder" class="table-of-contents__link">What about <code>mail-state</code> folder?</a></li><li><a href="#how-can-i-configure-my-email-client" class="table-of-contents__link">How can I configure my email client?</a></li><li><a href="#how-can-i-manage-my-custom-spamassassin-rules" class="table-of-contents__link">How can I manage my custom Spamassassin rules?</a></li><li><a href="#what-are-acceptable-sa_spam_subject-values" class="table-of-contents__link">What are acceptable <code>SA_SPAM_SUBJECT</code> values?</a></li><li><a href="#can-i-use-nakedbare-domains-no-host-name" class="table-of-contents__link">Can I use naked/bare domains (no host name)?</a></li><li><a href="#why-are-spamassassin-x-headers-not-inserted-into-my-sampledomaincom-subdomain-emails" class="table-of-contents__link">Why are Spamassassin x-headers not inserted into my sample.domain.com subdomain emails?</a></li><li><a href="#how-can-i-make-spamassassin-learn-spam" class="table-of-contents__link">How can I make SpamAssassin learn spam?</a></li><li><a href="#how-can-i-configure-a-catch-all" class="table-of-contents__link">How can I configure a catch-all?</a></li><li><a href="#how-can-i-delete-all-the-e-mails-for-a-specific-user" class="table-of-contents__link">How can I delete all the e-mails for a specific user?</a></li><li><a href="#how-do-i-have-more-control-about-what-spamassasin-is-filtering" class="table-of-contents__link">How do I have more control about what SPAMASSASIN is filtering?</a></li><li><a href="#what-kind-of-ssl-certificates-can-i-use" class="table-of-contents__link">What kind of SSL certificates can I use?</a></li><li><a href="#i-just-moved-from-my-old-mail-server-but-it-doesnt-work" class="table-of-contents__link">I just moved from my old mail server but &quot;it doesn&#39;t work&quot;.</a></li><li><a href="#which-system-requirements-needs-my-container-to-run-docker-mailserver-effectively" class="table-of-contents__link">Which system requirements needs my container to run <code>docker-mailserver</code> effectively?</a></li><li><a href="#is-docker-mailserver-running-in-a-rancher-environment" class="table-of-contents__link">Is <code>docker-mailserver</code> running in a rancher environment?</a></li><li><a href="#how-can-i-authenticate-users-with-smtp_only" class="table-of-contents__link">How can I authenticate users with SMTP_ONLY?</a></li><li><a href="#common-errors" class="table-of-contents__link">Common errors</a></li><li><a href="#using-behind-proxy" class="table-of-contents__link">Using behind proxy</a></li><li><a href="#what-about-updates" class="table-of-contents__link">What about updates</a></li><li><a href="#howto-adjust-settings-with-the-user-patchessh-script" class="table-of-contents__link">Howto adjust settings with the user-patches.sh script</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docker-mailserver/docs/">Wiki Example</a></li><li class="footer__item"><a class="footer__link-item" href="/docker-mailserver/docs/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docker-mailserver/blog">Releases</a></li><li class="footer__item"><a href="https://github.com/polarathene/docker-mailserver" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 [_Docker Mailserver Organization_](https://github.com/docker-mailserver). This project is licensed under the MIT license. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docker-mailserver/styles.d864945f.js"></script>
<script src="/docker-mailserver/runtime~main.f1b5c049.js"></script>
<script src="/docker-mailserver/main.428bc413.js"></script>
<script src="/docker-mailserver/1.f37643b9.js"></script>
<script src="/docker-mailserver/2.156766f6.js"></script>
<script src="/docker-mailserver/55.abd3ce97.js"></script>
<script src="/docker-mailserver/56.54fdbbae.js"></script>
<script src="/docker-mailserver/935f2afb.5d2e2556.js"></script>
<script src="/docker-mailserver/17896441.06341064.js"></script>
<script src="/docker-mailserver/bdc4edb4.38835913.js"></script>
</body>
</html>