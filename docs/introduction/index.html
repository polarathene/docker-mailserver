<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/docker-mailserver/blog/rss.xml" title="Docker Mailserver Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docker-mailserver/blog/atom.xml" title="Docker Mailserver Blog Atom Feed"><title data-react-helmet="true">An Introduction to Mail Servers | Docker Mailserver</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="An Introduction to Mail Servers | Docker Mailserver"><meta data-react-helmet="true" name="description" content="What is a mail server and how does it perform its duty?"><meta data-react-helmet="true" property="og:description" content="What is a mail server and how does it perform its duty?"><meta data-react-helmet="true" property="og:url" content="https://polarathene.github.io/docker-mailserver/docs/introduction"><link data-react-helmet="true" rel="shortcut icon" href="/docker-mailserver/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://polarathene.github.io/docker-mailserver/docs/introduction"><link rel="stylesheet" href="/docker-mailserver/styles.412d942f.css">
<link rel="preload" href="/docker-mailserver/styles.d864945f.js" as="script">
<link rel="preload" href="/docker-mailserver/runtime~main.f1b5c049.js" as="script">
<link rel="preload" href="/docker-mailserver/main.428bc413.js" as="script">
<link rel="preload" href="/docker-mailserver/1.f37643b9.js" as="script">
<link rel="preload" href="/docker-mailserver/2.156766f6.js" as="script">
<link rel="preload" href="/docker-mailserver/55.abd3ce97.js" as="script">
<link rel="preload" href="/docker-mailserver/56.54fdbbae.js" as="script">
<link rel="preload" href="/docker-mailserver/935f2afb.5d2e2556.js" as="script">
<link rel="preload" href="/docker-mailserver/17896441.06341064.js" as="script">
<link rel="preload" href="/docker-mailserver/e0a19902.d92605c1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docker-mailserver/"><img src="/docker-mailserver/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/docker-mailserver/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docker Mailserver</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docker-mailserver/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/polarathene/docker-mailserver" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docker-mailserver/"><img src="/docker-mailserver/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/docker-mailserver/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docker Mailserver</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docker-mailserver/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/polarathene/docker-mailserver" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docker-mailserver/docs/">Home</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docker-mailserver/docs/introduction">An Introduction to Mail Servers</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/setupsh">Your best friend setup.sh</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">User Management</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-accounts">Configure Accounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-aliases">Configure Aliases</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-dkim">Configure DKIM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-dmarc">Configure DMARC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-spf">Configure SPF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-autodiscover">Autodiscovery</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/understanding-ports">Understanding the ports</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-ssl">SSL/TLS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-fail2ban">Configure Fail2Ban</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">When something went wrong</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/faq">FAQ and Tips</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/config-pop3">Mail delivery with POP3</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/optional-configuration">Optional Configuration</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Maintenance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/update-and-cleanup">Update &amp; Cleanup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Override the default config of</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/override-dovecot">Override the default config of Dovecot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/override-postfix">Override the default config of Postfix</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/email-sieve">Email filtering with Sieve Filters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/email-fetchmail">Email gathering with fetchmail</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Email forwarding with</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/email-forward-relayhosts">Email forwarding with Relay Hosts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/email-forward-awsses">Email forwarding with AWS SES</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/fulltext-search">Full-text Search</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/kubernetes">Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/ipv6">IPv6</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/faq">FAQ and Tips</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/install-examples">Installation Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Use Cases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/docs/usecase-forwardonly-ldap-auth">Forward-Only mailserver with LDAP authentication</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">An Introduction to Mail Servers</h1></header><div class="markdown"><p>What is a mail server and how does it perform its duty?<br>
Here&#x27;s an introduction to the field that covers everything you need to know to get started with <code>docker-mailserver</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="anatomy-of-a-mail-server"></a>Anatomy of a mail server<a class="hash-link" href="#anatomy-of-a-mail-server" title="Direct link to heading">#</a></h2><p>A mail server is only a part of a <a href="https://en.wikipedia.org/wiki/Client%E2%80%93server_model" target="_blank" rel="noopener noreferrer">client-server relationship</a> aimed at exchanging information in the form of <a href="https://en.wikipedia.org/wiki/Email" target="_blank" rel="noopener noreferrer">emails</a>. Exchanging emails requires using specific means (programs and protocols).</p><p><code>docker-mailserver</code> provides you with the server portion, whereas the client can be anything from a terminal via text-based software (eg. <a href="https://en.wikipedia.org/wiki/Mutt_(email_client)" target="_blank" rel="noopener noreferrer">Mutt</a>) to a fully-fledged desktop application (eg. <a href="https://en.wikipedia.org/wiki/Mozilla_Thunderbird" target="_blank" rel="noopener noreferrer">Mozilla Thunderbird</a>, <a href="https://en.wikipedia.org/wiki/Microsoft_Outlook" target="_blank" rel="noopener noreferrer">Microsoft Outlook</a>…), to a web interface, etc.</p><p>Unlike the client-side where usually a single program is used to perform retrieval and viewing of emails, the server-side is composed of many specialized components. The mail server is capable of accepting, forwarding, delivering, storing and overall exchanging messages, but each one of those tasks is actually handled by a specific piece of software. All of these &quot;agents&quot; must be integrated with one another for the exchange to take place.</p><p><code>docker-mailserver</code> has made informed choices about those components and their (default) configuration. It offers a comprehensive platform to run a fully featured mail server in no time!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="components"></a>Components<a class="hash-link" href="#components" title="Direct link to heading">#</a></h2><p>The following components are required to create a <a href="https://en.wikipedia.org/wiki/Email_agent_(infrastructure)" target="_blank" rel="noopener noreferrer">complete delivery chain</a>:</p><ul><li>MUA: a <a href="https://en.wikipedia.org/wiki/Email_client" target="_blank" rel="noopener noreferrer">Mail User Agent</a> is basically any client/program capable of sending emails to arbitrary mail servers; while also capable of fetching emails from mail servers for presenting them to the end users.</li><li>MTA: a <a href="https://en.wikipedia.org/wiki/Message_transfer_agent" target="_blank" rel="noopener noreferrer">Mail Transfer Agent</a> is the so-called &quot;mail server&quot; as seen from the MUA&#x27;s perspective. It&#x27;s a piece of software dedicated to accepting submitted emails, then forwarding them-where exactly will depend on an email&#x27;s final destination. If the receiving MTA is responsible for the hostname the email is sent to, then an MTA is to forward that email to an MDA (see below). Otherwise, it is to transfer (ie. forward, relay) to another MTA, &quot;closer&quot; to the email&#x27;s final destination.</li><li>MDA: a <a href="https://en.wikipedia.org/wiki/Mail_delivery_agent" target="_blank" rel="noopener noreferrer">Mail Delivery Agent</a> is responsible for accepting emails from an MTA and dropping them into their recipients&#x27; mailboxes, whichever the form.</li></ul><p>Here&#x27;s a schematic view of mail delivery:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-txt codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Sending an email:    MUA ----&gt; MTA ----&gt; (MTA relays) ----&gt; MDA</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Fetching an email:   MUA &lt;--------------------------------- MDA</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>There may be other moving parts or sub-divisions (for instance, at several points along the chain, specialized programs may be analyzing, filtering, bouncing, editing… the exchanged emails).</p><p>In a nutshell, <code>docker-mailserver</code> provides you with the following components:</p><ul><li>A MTA: <a href="http://www.postfix.org/" target="_blank" rel="noopener noreferrer">Postfix</a></li><li>A MDA: <a href="https://dovecot.org/" target="_blank" rel="noopener noreferrer">Dovecot</a></li><li>A bunch of additional programs to improve security and emails processing</li></ul><p>Here&#x27;s where <code>docker-mailserver</code>&#x27;s toochain fits within the delivery chain:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-txt codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                    docker-mailserver is here:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                         ┏━━━━━━━┓</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Sending an email:    MUA ---&gt; MTA ---&gt; (MTA relays) ---&gt; ┫ MTA ╮ ┃</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Fetching an email:   MUA &lt;------------------------------ ┫ MDA ╯ ┃</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                                         ┗━━━━━━━┛</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><blockquote><p>Let&#x27;s say Alice owns a Gmail account, <code>alice@gmail.com</code>; and Bob owns an account on a <code>docker-mailserver</code>&#x27;s instance, <code>bob@dms.io</code>.</p><p>Make sure not to conflate these two very different scenarios:
A) Alice sends an email to <code>bob@dms.io</code> =&gt; the email is first submitted to MTA <code>smtp.gmail.com</code>, then relayed to MTA <code>smtp.dms.io</code> where it is then delivered into Bob&#x27;s mailbox.
B) Bob sends an email to <code>alice@gmail.com</code> =&gt; the email is first submitted to MTA <code>smtp.dms.io</code>, then relayed to MTA <code>smtp.gmail.com</code> and eventually delivered into Alice&#x27;s mailbox.</p><p>In scenario <em>A</em> the email leaves Gmail&#x27;s premises, that email&#x27;s <em>initial</em> submission is <em>not</em> handled by your <code>docker-mailserver</code> instance(MTA); it merely receives the email after it has been relayed by Gmail&#x27;s MTA. In scenario <em>B</em>, the <code>docker-mailserver</code> instance(MTA) handles the submission, prior to relaying.</p><p>The main takeaway is that when a third-party sends an email to a <code>docker-mailserver</code> instance(MTA) (or any MTA for that matter), it does <em>not</em> establish a direct connection with that MTA. Email submission first goes through the sender&#x27;s MTA, then some relaying between at least two MTAs is required to deliver the email. That will prove very important when it comes to security management.</p></blockquote><p>One important thing to note is that MTA and MDA programs may actually handle <em>multiple</em> tasks (which is the case with <code>docker-mailserver</code>&#x27;s Postfix and Dovecot).</p><p>For instance, Postfix is both an SMTP server (accepting emails) and a relaying MTA (transferring, ie. sending emails to other MTA/MDA); Dovecot is both an MDA (delivering emails in mailboxes) and an IMAP server (allowing MUAs to fetch emails from the <em>mail server</em>). On top of that, Postfix may rely on Dovecot&#x27;s authentication capabilities.</p><p>The exact relationship between all the components and their respective (sometimes shared) responsibilities is beyond the scope of this document. Please explore this wiki &amp; the web to get more insights about <code>docker-mailserver</code>&#x27;s toolchain.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="about-security--ports"></a>About security &amp; ports<a class="hash-link" href="#about-security--ports" title="Direct link to heading">#</a></h2><p>In the previous section, different components were outlined. Each one of those is responsible for a specific task, it has a specific purpose.</p><p>Three main purposes exist when it comes to exchanging emails:</p><ul><li><em>Submission</em>: for a MUA (client), the act of sending actual email data over the network, toward an MTA (server).</li><li><em>Transfer</em> (aka. <em>Relay</em>): for an MTA, the act of sending actual email data over the network, toward another MTA (server) closer to the final destination (where an MTA will forward data to an MDA).</li><li><em>Retrieval</em>: for a MUA (client), the act of fetching actual email data over the network, from an MDA.</li></ul><p>Postfix handles Submission (and might handle Relay), whereas Dovecot handles Retrieval. They both need to be accessible by MUAs in order to act as servers, therefore they expose public endpoints on specific TCP ports (see. <a href="https://github.com/tomav/docker-mailserver/wiki/Understanding-the-ports" target="_blank" rel="noopener noreferrer"><em>Understanding the ports</em></a> for more details). Those endpoints <em>may</em> be secured, using an encryption scheme and TLS certificates.</p><p>When it comes to the specifics of email exchange, we have to look at protocols and ports enabled to support all the identified purposes. There are several valid options and they&#x27;ve been evolving overtime.</p><p><strong>Here&#x27;s <code>docker-mailserver</code>&#x27;s <em>default</em> configuration:</strong></p><table><thead><tr><th>Purpose</th><th>Protocol</th><th>TCP port / encryption</th></tr></thead><tbody><tr><td>Transfer/Relay</td><td>SMTP</td><td>25 (unencrypted)</td></tr><tr><td>Submission</td><td>ESMTP</td><td>587 (encrypted using STARTTLS)</td></tr><tr><td>Retrieval</td><td>IMAP4</td><td>143 (encrypted using STARTTLS) + 993 (TLS)</td></tr><tr><td>Retrieval</td><td>POP3</td><td><em>Not activated</em></td></tr></tbody></table><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-txt codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ┏━━━━━━━━━━ Submission ━━━━━━━━━┓┏━━━━━━━━━━━━━ Transfer/Relay ━━━━━━━━━━━┓</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        ┌─────────────────────┐                    ┌┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MUA ----- STARTTLS ---&gt; ┤(587)   MTA ╮    (25)├ &lt;-- cleartext ---&gt; ┊ Third-party MTA ┊</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ---- cleartext ---&gt; ┤(25)        │        |                    └┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        |┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">MUA &lt;---- STARTTLS ---- ┤(143)   MDA ╯        |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;-- enforced TLS -- ┤(993)                |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        └─────────────────────┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ┗━━━━━━━━━━ Retrieval ━━━━━━━━━━┛</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If you&#x27;re new to email infrastructure, both that table and the schema may be confusing.<br>
Read on to expand your understanding and learn about <code>docker-mailserver</code>&#x27;s configuration, including how you can customize it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="submission---smtp"></a>Submission - SMTP<a class="hash-link" href="#submission---smtp" title="Direct link to heading">#</a></h3><p>For a MUA to send an email to an MTA, it needs to establish a connection with that server, then push data packets over a network that both the MUA (client) and the MTA (server) are connected to. The server implements the <a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" target="_blank" rel="noopener noreferrer">SMTP</a> protocol, which makes it capable of handling <em>Submission</em>.</p><p>In the case of <code>docker-mailserver</code>, the MTA (SMTP server) is Postfix. The MUA (client) may vary, yet its Submission request is performed as <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol" target="_blank" rel="noopener noreferrer">TCP</a> packets sent over the <em>public</em> internet. This exchange of information may be secured in order to counter eavesdropping.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="two-kinds-of-submission"></a>Two kinds of Submission<a class="hash-link" href="#two-kinds-of-submission" title="Direct link to heading">#</a></h4><p>Let&#x27;s say I own an account on a <code>docker-mailserver</code> instance, <code>me@dms.io</code>. There are two very different use-cases for Submission:</p><ol><li>I want to send an email to someone</li><li>Someone wants to send you an email</li></ol><p>In the first scenario, I will be submitting my email directly to my <code>docker-mailserver</code> instance/MTA (Postfix), which will then relay the email to its recipient&#x27;s MTA for final delivery. In this case, Submission is first handled by establishing a direct connection to my own MTA-so at least for this portion of the delivery chain, I&#x27;ll be able to ensure security/confidentiality. Not so much for what comes next, ie. relaying between MTAs and final delivery.</p><p>In the second scenario, a third-party email account owner will be first submitting an email to some third-party MTA. I have no control over this initial portion of the delivery chain, nor do I have control over the relaying that comes next. My MTA will merely accept a relayed email coming &quot;out of the blue&quot;.</p><p>My MTA will thus have to support two kinds of Submission:</p><ul><li>Outward Submission (self-owned email is submitted directly to the MTA, then is relayed &quot;outside&quot;)</li><li>Inward Submission (third-party email has been submitted &amp; relayed, then is accepted &quot;inside&quot; by the MTA)</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-txt codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ┏━━━━ Outward Submission ━━━━┓</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    ┌────────────────────┐                    ┌┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Me ---------------&gt; ┤                    ├ -----------------&gt; ┊                 ┊</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    │       My MTA       │                    ┊ Third-party MTA ┊</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    │                    ├ &lt;----------------- ┊                 ┊</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    └────────────────────┘                    └┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                               ┗━━━━━━━━━━ Inward Submission ━━━━━━━━━━┛</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="outward-submission"></a>Outward Submission<a class="hash-link" href="#outward-submission" title="Direct link to heading">#</a></h5><p>The best practice as of 2020 when it comes to securing Outward Submission is to use <em>Implicit TLS connection via ESMTP on port 465</em> (see <a href="https://tools.ietf.org/html/rfc8314" target="_blank" rel="noopener noreferrer">RFC 8314</a>). Let&#x27;s break it down.</p><ul><li>Implicit TLS means the server <em>enforces</em> the client into using an encrypted TCP connection, using <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener noreferrer">TLS</a>. With this kind of connection, the MUA <em>has</em> to establish a TLS-encrypted connection from the get go (TLS is implied, hence the name &quot;Implicit&quot;). Any client attempting to either submit email in cleartext (unencrypted, not secure), or requesting a cleartext connection to be upgraded to a TLS-encrypted one using <code>STARTTLS</code>, is to be denied. Implicit TLS is sometimes called Enforced TLS for that reason.</li><li><a href="https://en.wikipedia.org/wiki/ESMTP" target="_blank" rel="noopener noreferrer">ESMTP</a> is <a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" target="_blank" rel="noopener noreferrer">SMTP</a> + extensions. It&#x27;s the version of the SMTP protocol that most mail servers speak nowadays. For the purpose of this documentation, ESMTP and SMTP are synonymous.</li><li>Port 465 is the reserved TCP port for Implicit TLS Submission (since 2018). There is actually a boisterous history to that ports usage, but let&#x27;s keep it simple.</li></ul><blockquote><p>Note: This Submission setup is sometimes refered to as <a href="https://en.wikipedia.org/wiki/SMTPS" target="_blank" rel="noopener noreferrer">SMTPS</a>. Long story short: this is incorrect and should be avoided.</p></blockquote><p>Although a very satisfactory setup, Implicit TLS on port 465 is somewhat &quot;cutting edge&quot;. There exists another well established mail Submission setup that must be supported as well, SMTP+STARTTLS on port 587. It uses Explicit TLS: the client starts with a cleartext connection, then the server informs a TLS-encrypted &quot;upgraded&quot; connection may be established, and the client <em>may</em> eventually decide to establish it prior to the Submission. Basically it&#x27;s an opportunistic, opt-in TLS upgrade of the connection between the client and the server, at the client&#x27;s discretion, using a mechanism known as <a href="https://en.wikipedia.org/wiki/Opportunistic_TLS" target="_blank" rel="noopener noreferrer">STARTTLS</a> that both ends need to implement.</p><p>In many implementations, the mail server doesn&#x27;t enforce TLS encryption, for backwards compatibility. Clients are thus free to deny the TLS-upgrade proposal (or <a href="https://security.stackexchange.com/questions/168998/what-happens-if-starttls-dropped-in-smtp" target="_blank" rel="noopener noreferrer">misled by a hacker</a> about STARTTLS not being available), and the server accepts unencrypted (cleartext) mail exchange, which poses a confidentiality threat and, to some extent, spam issues. <a href="https://tools.ietf.org/html/rfc8314" target="_blank" rel="noopener noreferrer">RFC 8314 (section 3.3)</a> recommends for mail servers to support both Implicit and Explicit TLS for Submission, <em>and</em> to enforce TLS-encryption on ports 587 (Explicit TLS) and 465 (Implicit TLS). That&#x27;s exactly <code>docker-mailserver</code>&#x27;s default configuration: abiding by RFC 8314, it <a href="http://www.postfix.org/postconf.5.html#smtpd_tls_security_level" target="_blank" rel="noopener noreferrer">enforces a strict (<code>encrypt</code>) STARTTLS policy</a>, where a denied TLS upgrade terminates the connection thus (hopefully but at the client&#x27;s discretion) preventing unencrypted (cleartext) Submission.</p><ul><li><strong><code>docker-mailserver</code>&#x27;s default configuration enables and <em>requires</em> Explicit TLS (STARTTLS) on port 587 for Outward Submission.</strong></li><li>It does not enable Implicit TLS Outward Submission on port 465 by default. One may enable it through simple custom configuration, either as a replacement or (better!) supplementary mean of secure Submission.</li><li>It does not support old MUAs (clients) not supporting TLS encryption on ports 587/465 (those should perform Submission on port 25, more details below). One may relax that constraint through advanced custom configuration, for backwards compatibility.</li></ul><p>A final Outward Submission setup exists and is akin SMTP+STARTTLS on port 587, but on port 25. That port has historically been reserved specifically for unencrypted (cleartext) mail exchange though, making STARTTLS a bit wrong to use. As is expected by <a href="https://tools.ietf.org/html/rfc5321" target="_blank" rel="noopener noreferrer">RFC 5321</a>, <code>docker-mailserver</code> uses port 25 for unencrypted Submission in order to support older clients, but most importantly for unencrypted Transfer/Relay between MTAs.</p><ul><li><strong><code>docker-mailserver</code>&#x27;s default configuration also enables unencrypted (cleartext) on port 25 for Outward Submission.</strong></li><li>It does not enable Explicit TLS (STARTTLS) on port 25 by default. One may enable it through advanced custom configuration, either as a replacement (bad!) or as a supplementary mean of secure Outward Submission.</li><li>One may also secure Outward Submission using advanced encryption scheme, such as DANE/DNSSEC and/or MTA-STS.</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="inward-submission"></a>Inward Submission<a class="hash-link" href="#inward-submission" title="Direct link to heading">#</a></h5><p>Granted it&#x27;s still very difficult enforcing encryption between MTAs (Transfer/Relay) without risking dropping emails (when relayed by MTAs not supporting TLS-encryption), Inward Submission is to be handled in cleartext on port 25 by default.</p><ul><li><strong><code>docker-mailserver</code>&#x27;s default configuration enables unencrypted (cleartext) on port 25 for Inward Submission.</strong></li><li>It does not enable Explicit TLS (STARTTLS) on port 25 by default. One may enable it through advanced custom configuration, either as a replacement (bad!) or as a supplementary mean of secure Inward Submission.</li><li>One may also secure Inward Submission using advanced encryption scheme, such as DANE/DNSSEC and/or MTA-STS.</li></ul><p>Overall, <code>docker-mailserver</code>&#x27;s default configuration for SMTP looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-txt codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> ┏━━━━ Outward Submission ━━━━┓</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    ┌────────────────────┐                    ┌┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┐</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Me -- cleartext --&gt; ┤(25)            (25)├ --- cleartext ---&gt; ┊                 ┊</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Me -- STARTTLS ---&gt; ┤(587)  My MTA       │                    ┊ Third-party MTA ┊</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    │                (25)├ &lt;---cleartext ---- ┊                 ┊</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    └────────────────────┘                    └┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┄┘</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                               ┗━━━━━━━━━━ Inward Submission ━━━━━━━━━━┛</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="retrieval---imap"></a>Retrieval - IMAP<a class="hash-link" href="#retrieval---imap" title="Direct link to heading">#</a></h3><p>A MUA willing to fetch an email from a mail server will most likely communicate with its <a href="https://en.wikipedia.org/wiki/IMAP" target="_blank" rel="noopener noreferrer">IMAP</a> server. As with SMTP described earlier, communication will take place in the form of data packets exchanged over a network that both the client and the server are connected to. The IMAP protocol makes the server capable of handling <em>Retrieval</em>.</p><p>In the case of <code>docker-mailserver</code>, the IMAP server is Dovecot. The MUA (client) may vary, yet its Retrieval request is performed as <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol" target="_blank" rel="noopener noreferrer">TCP</a> packets sent over the <em>public</em> internet. This exchange of information may be secured in order to counter eavesdropping.</p><p>Again, as with SMTP described earlier, the IMAP protocol may be secured with either Implicit TLS (aka. <a href="https://en.wikipedia.org/wiki/IMAPS" target="_blank" rel="noopener noreferrer">IMAPS</a>/IMAP4S) or Explicit TLS (using STARTTLS).</p><p>The best practice as of 2020 is to enforce IMAPS on port 993, rather than IMAP+STARTTLS on port 143 (see <a href="https://tools.ietf.org/html/rfc8314" target="_blank" rel="noopener noreferrer">RFC 8314</a>); yet the latter is usually provided for backwards compatibility.</p><p><strong><code>docker-mailserver</code>&#x27;s default configuration enables both Implicit and Explicit TLS for Retrievial, on ports 993 and 143 respectively.</strong></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="retrieval---pop3"></a>Retrieval - POP3<a class="hash-link" href="#retrieval---pop3" title="Direct link to heading">#</a></h3><p>Similarly to IMAP, the older POP3 protocol may be secured with either Implicit or Explicit TLS.</p><p>The best practice as of 2020 would be <a href="https://en.wikipedia.org/wiki/POP3S" target="_blank" rel="noopener noreferrer">POP3S</a> on port 995, rather than <a href="https://en.wikipedia.org/wiki/POP3" target="_blank" rel="noopener noreferrer">POP3</a>+STARTTLS on port 110 (see <a href="https://tools.ietf.org/html/rfc8314" target="_blank" rel="noopener noreferrer">RFC 8314</a>).</p><p><strong><code>docker-mailserver</code>&#x27;s default configuration disables POP3 altogether.</strong> One should expect MUAs to use TLS-encrypted IMAP for Retrieval.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-does-docker-mailserver-help-with-setting-everything-up"></a>How does <code>docker-mailserver</code> help with setting everything up?<a class="hash-link" href="#how-does-docker-mailserver-help-with-setting-everything-up" title="Direct link to heading">#</a></h2><p>As a <em>batteries included</em> Docker image, <code>docker-mailserver</code> provides you with all the required components and a default configuration, to run a decent and secure mail server.</p><p>One may then customize all aspects of its internal components.</p><ul><li>Simple customization is supported through <a href="https://github.com/tomav/docker-mailserver/blob/master/docker-compose.yml.dist" target="_blank" rel="noopener noreferrer">docker-compose configuration</a> and the <a href="https://github.com/tomav/docker-mailserver/blob/master/env-mailserver.dist" target="_blank" rel="noopener noreferrer">env-mailserver</a> configuration file.</li><li>Advanced customization is supported through providing &quot;monkey-patching&quot; configuration files and/or <a href="https://github.com/tomav/docker-mailserver/blob/master/Dockerfile" target="_blank" rel="noopener noreferrer">deriving your own image</a> from <code>docker-mailserver</code>&#x27;s upstream, for a complete control over how things run.</li></ul><p>On the subject of security, one might consider <code>docker-mailserver</code>&#x27;s <strong>default</strong> configuration to <em>not</em> be 100% secure:</p><ul><li>it enables unencrypted traffic on port 25</li><li>it enables Explicit TLS (STARTTLS) on port 587, instead of Implicit TLS on port 465</li></ul><p>We believe <code>docker-mailserver</code>&#x27;s default configuration to be a good middle ground: it goes slightly beyond &quot;old&quot; (1999) <a href="https://tools.ietf.org/html/rfc2487" target="_blank" rel="noopener noreferrer">RFC 2487</a>; and with developer friendly configuration settings, it makes it pretty easy to abide by the &quot;newest&quot; (2018) <a href="https://tools.ietf.org/html/rfc8314" target="_blank" rel="noopener noreferrer">RFC 8314</a>.</p><p>Eventually, it is up to <em>you</em> deciding exactly what kind of transportation/encryption to use and/or enforce, and to customize your instance accordingly (with looser or stricter security). Be also aware that protocols and ports on your server can only go so far with security; third-party MTAs might relay your emails on insecure connections, man-in-the-middle attacks might still prove effective, etc. Advanced counter-measure such as DANE, MTA-STS and/or full body encryption (eg. PGP) should be considered as well for increased confidentiality, but ideally without compromising backwards compatibility so as to not block emails.</p><p>The <a href="https://github.com/tomav/docker-mailserver" target="_blank" rel="noopener noreferrer">README</a> is the best starting point in configuring and running your mail server. You may then explore this wiki to cover additional topics, including but not limited to, security.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/polarathene/docker-mailserver/tree/docs/docusaurus-demo/website/docs/Introduction.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docker-mailserver/docs/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Home</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docker-mailserver/docs/setupsh"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Your best friend setup.sh »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#anatomy-of-a-mail-server" class="table-of-contents__link">Anatomy of a mail server</a></li><li><a href="#components" class="table-of-contents__link">Components</a></li><li><a href="#about-security--ports" class="table-of-contents__link">About security &amp; ports</a><ul><li><a href="#submission---smtp" class="table-of-contents__link">Submission - SMTP</a></li><li><a href="#retrieval---imap" class="table-of-contents__link">Retrieval - IMAP</a></li><li><a href="#retrieval---pop3" class="table-of-contents__link">Retrieval - POP3</a></li></ul></li><li><a href="#how-does-docker-mailserver-help-with-setting-everything-up" class="table-of-contents__link">How does <code>docker-mailserver</code> help with setting everything up?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docker-mailserver/docs/">Wiki Example</a></li><li class="footer__item"><a class="footer__link-item" href="/docker-mailserver/docs/">Second Doc</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docker-mailserver/blog">Releases</a></li><li class="footer__item"><a href="https://github.com/polarathene/docker-mailserver" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 [_Docker Mailserver Organization_](https://github.com/docker-mailserver). This project is licensed under the MIT license. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docker-mailserver/styles.d864945f.js"></script>
<script src="/docker-mailserver/runtime~main.f1b5c049.js"></script>
<script src="/docker-mailserver/main.428bc413.js"></script>
<script src="/docker-mailserver/1.f37643b9.js"></script>
<script src="/docker-mailserver/2.156766f6.js"></script>
<script src="/docker-mailserver/55.abd3ce97.js"></script>
<script src="/docker-mailserver/56.54fdbbae.js"></script>
<script src="/docker-mailserver/935f2afb.5d2e2556.js"></script>
<script src="/docker-mailserver/17896441.06341064.js"></script>
<script src="/docker-mailserver/e0a19902.d92605c1.js"></script>
</body>
</html>