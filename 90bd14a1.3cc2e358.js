(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{125:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return b}));var n=a(0),r=a.n(n);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=r.a.createContext({}),u=function(e){var t=r.a.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=u(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(a),m=n,b=d["".concat(i,".").concat(m)]||d[m]||p[m]||s;return a?r.a.createElement(b,o(o({ref:t},c),{},{components:a})):r.a.createElement(b,o({ref:t},c))}));function b(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,i=new Array(s);i[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var c=2;c<s;c++)i[c]=a[c];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"},98:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return o})),a.d(t,"toc",(function(){return l})),a.d(t,"default",(function(){return u}));var n=a(3),r=a(7),s=(a(0),a(125)),i={id:"usecase-forwardonly-ldap-auth",title:"Forward-Only mailserver with LDAP authentication"},o={unversionedId:"usecase-forwardonly-ldap-auth",id:"usecase-forwardonly-ldap-auth",isDocsHomePage:!1,title:"Forward-Only mailserver with LDAP authentication",description:"Building a Forward-Only mailserver",source:"@site/docs/Forward-Only-mailserver-with-LDAP-authentication.md",slug:"/usecase-forwardonly-ldap-auth",permalink:"/docker-mailserver/docs/usecase-forwardonly-ldap-auth",editUrl:"https://github.com/polarathene/docker-mailserver/tree/docs/docusaurus-demo/website/docs/Forward-Only-mailserver-with-LDAP-authentication.md",version:"current",sidebar:"docs",previous:{title:"Installation Examples",permalink:"/docker-mailserver/docs/install-examples"}},l=[{value:"Building a Forward-Only mailserver",id:"building-a-forward-only-mailserver",children:[]},{value:"Authenticating with LDAP",id:"authenticating-with-ldap",children:[]}],c={toc:l};function u(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(s.b)("wrapper",Object(n.a)({},c,a,{components:t,mdxType:"MDXLayout"}),Object(s.b)("h2",{id:"building-a-forward-only-mailserver"},"Building a Forward-Only mailserver"),Object(s.b)("p",null,"A ",Object(s.b)("strong",{parentName:"p"},"forward-only")," mailserver does not have any local mailboxes. Instead, it has only aliases that forward emails to external email accounts (for example to a gmail account). You can also send email from the localhost (the computer where the mailserver is installed), using as sender any of the alias addresses."),Object(s.b)("p",null,"The important settings for this setup (on ",Object(s.b)("inlineCode",{parentName:"p"},"mailserver.env"),") are these:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-console"},"PERMIT_DOCKER=host\nENABLE_POP3=\nENABLE_CLAMAV=0\nSMTP_ONLY=1\nENABLE_SPAMASSASSIN=0\nENABLE_FETCHMAIL=0\n")),Object(s.b)("p",null,"Since there are no local mailboxes, we use ",Object(s.b)("inlineCode",{parentName:"p"},"SMTP_ONLY=1")," to disable ",Object(s.b)("inlineCode",{parentName:"p"},"dovecot"),". We disable as well the other services that are related to local mailboxes (",Object(s.b)("inlineCode",{parentName:"p"},"POP3"),", ",Object(s.b)("inlineCode",{parentName:"p"},"ClamAV"),", ",Object(s.b)("inlineCode",{parentName:"p"},"SpamAssassin"),", etc.)"),Object(s.b)("p",null,"We can create aliases with ",Object(s.b)("inlineCode",{parentName:"p"},"./setup.sh"),", like this:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-bash"},"./setup.sh alias add <alias-address> <external-email-account>\n")),Object(s.b)("h2",{id:"authenticating-with-ldap"},"Authenticating with LDAP"),Object(s.b)("p",null,"If you want to send emails from outside the mailserver you have to authenticate somehow (with a username and password). One way of doing it is described in ",Object(s.b)("a",{parentName:"p",href:"https://github.com/tomav/docker-mailserver/issues/1247"},"this discussion"),". However if there are many user accounts, it is better to use authentication with LDAP. The settings for this on ",Object(s.b)("inlineCode",{parentName:"p"},"mailserver.env")," are:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-console"},"ENABLE_LDAP=1\nLDAP_START_TLS=yes\nLDAP_SERVER_HOST=ldap.example.org\nLDAP_SEARCH_BASE=ou=users,dc=example,dc=org\nLDAP_BIND_DN=cn=mailserver,dc=example,dc=org\nLDAP_BIND_PW=pass1234\n\nENABLE_SASLAUTHD=1\nSASLAUTHD_MECHANISMS=ldap\nSASLAUTHD_LDAP_SERVER=ldap.example.org\nSASLAUTHD_LDAP_SSL=0\nSASLAUTHD_LDAP_START_TLS=yes\nSASLAUTHD_LDAP_BIND_DN=cn=mailserver,dc=example,dc=org\nSASLAUTHD_LDAP_PASSWORD=pass1234\nSASLAUTHD_LDAP_SEARCH_BASE=ou=users,dc=example,dc=org\nSASLAUTHD_LDAP_FILTER=(&(uid=%U)(objectClass=inetOrgPerson))\n")),Object(s.b)("p",null,"My LDAP data structure is very basic, containing only the username, password, and the external email address where to forward emails for this user. An entry looks like this"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-console"},"add uid=username,ou=users,dc=example,dc=org\nuid: username\nobjectClass: inetOrgPerson\nsn: username\ncn: username\nuserPassword: {SSHA}abcdefghi123456789\nemail: real-email-address@external-domain.com\n")),Object(s.b)("p",null,"This structure is different from what is expected/assumed from the configuration scripts of the mailserver, so it doesn't work just by using the ",Object(s.b)("inlineCode",{parentName:"p"},"LDAP_QUERY_FILTER_...")," settings. Instead, I had to do ",Object(s.b)("a",{parentName:"p",href:"https://github.com/tomav/docker-mailserver#custom-user-changes--patches"},"custom configuration"),". I created the script ",Object(s.b)("inlineCode",{parentName:"p"},"config/user-patches.sh"),", with a content like this:"),Object(s.b)("pre",null,Object(s.b)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n\nrm -f /etc/postfix/{ldap-groups.cf,ldap-domains.cf}\n\npostconf \\\n    \"virtual_mailbox_domains = /etc/postfix/vhost\" \\\n    \"virtual_alias_maps = ldap:/etc/postfix/ldap-aliases.cf texthash:/etc/postfix/virtual\" \\\n    \"smtpd_sender_login_maps = ldap:/etc/postfix/ldap-users.cf\"\n\nsed -i /etc/postfix/ldap-users.cf \\\n    -e '/query_filter/d' \\\n    -e '/result_attribute/d' \\\n    -e '/result_format/d'\ncat <<EOF >> /etc/postfix/ldap-users.cf\nquery_filter = (uid=%u)\nresult_attribute = uid\nresult_format = %s@example.org\nEOF\n\nsed -i /etc/postfix/ldap-aliases.cf \\\n    -e '/domain/d' \\\n    -e '/query_filter/d' \\\n    -e '/result_attribute/d'\ncat <<EOF >> /etc/postfix/ldap-aliases.cf\ndomain = example.org\nquery_filter = (uid=%u)\nresult_attribute = mail\nEOF\n\npostfix reload\n")),Object(s.b)("p",null,"You see that besides ",Object(s.b)("inlineCode",{parentName:"p"},"query_filter"),", I had to customize as well ",Object(s.b)("inlineCode",{parentName:"p"},"result_attribute")," and ",Object(s.b)("inlineCode",{parentName:"p"},"result_format"),"."),Object(s.b)("p",null,"For more details about using LDAP see: ",Object(s.b)("a",{parentName:"p",href:"https://www.vennedey.net/resources/2-LDAP-managed-mail-server-with-Postfix-and-Dovecot-for-multiple-domains"},"LDAP managed mail server with Postfix and Dovecot for multiple domains")),Object(s.b)("p",null,"Another solution that serves as a forward-only mailserver is this: ",Object(s.b)("a",{parentName:"p",href:"https://gitlab.com/docker-scripts/postfix"},"https://gitlab.com/docker-scripts/postfix")))}u.isMDXComponent=!0}}]);