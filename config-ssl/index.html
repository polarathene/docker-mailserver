<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/docker-mailserver/blog/rss.xml" title="Docker Mailserver Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docker-mailserver/blog/atom.xml" title="Docker Mailserver Blog Atom Feed"><title data-react-helmet="true">SSL/TLS | Docker Mailserver</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="SSL/TLS | Docker Mailserver"><meta data-react-helmet="true" name="description" content="There are multiple options to enable SSL:"><meta data-react-helmet="true" property="og:description" content="There are multiple options to enable SSL:"><meta data-react-helmet="true" property="og:url" content="https://polarathene.github.io/docker-mailserver/config-ssl"><link data-react-helmet="true" rel="shortcut icon" href="/docker-mailserver/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://polarathene.github.io/docker-mailserver/config-ssl"><link rel="stylesheet" href="/docker-mailserver/styles.4b6ef2b0.css">
<link rel="preload" href="/docker-mailserver/styles.0a2c2036.js" as="script">
<link rel="preload" href="/docker-mailserver/runtime~main.528323d4.js" as="script">
<link rel="preload" href="/docker-mailserver/main.e93513c9.js" as="script">
<link rel="preload" href="/docker-mailserver/1.a0b7a12a.js" as="script">
<link rel="preload" href="/docker-mailserver/2.2c4bde7c.js" as="script">
<link rel="preload" href="/docker-mailserver/36.56e87f6c.js" as="script">
<link rel="preload" href="/docker-mailserver/935f2afb.1219889f.js" as="script">
<link rel="preload" href="/docker-mailserver/17896441.7b889dd7.js" as="script">
<link rel="preload" href="/docker-mailserver/7e14cee2.34510799.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/docker-mailserver/"><img src="/docker-mailserver/img/logo.svg" alt="Docker Mailserver Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/docker-mailserver/img/logo.svg" alt="Docker Mailserver Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docker Mailserver</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/polarathene/docker-mailserver" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docker-mailserver/"><img src="/docker-mailserver/img/logo.svg" alt="Docker Mailserver Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/docker-mailserver/img/logo.svg" alt="Docker Mailserver Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Docker Mailserver</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/polarathene/docker-mailserver" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docker-mailserver/">Home</a></li><li class="menu__list-item"><a class="menu__link" href="/docker-mailserver/introduction">An Introduction to Mail Servers</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker-mailserver/setupsh">Your best friend setup.sh</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">User Management</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/config-accounts">Configure Accounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/config-aliases">Configure Aliases</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Best Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/config-dkim">Configure DKIM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/config-dmarc">Configure DMARC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/config-spf">Configure SPF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/config-autodiscover">Autodiscovery</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Security</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker-mailserver/understanding-ports">Understanding the ports</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docker-mailserver/config-ssl">SSL/TLS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker-mailserver/config-fail2ban">Configure Fail2Ban</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">When something went wrong</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/faq">FAQ and Tips</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docker-mailserver/config-pop3">Mail delivery with POP3</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/optional-configuration">Optional Configuration</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Maintenance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/update-and-cleanup">Update &amp; Cleanup</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Override the default config of</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/override-dovecot">Override the default config of Dovecot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/override-postfix">Override the default config of Postfix</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/email-sieve">Email filtering with Sieve Filters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/email-fetchmail">Email gathering with fetchmail</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Email forwarding with</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/email-forward-relayhosts">Email forwarding with Relay Hosts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/email-forward-awsses">Email forwarding with AWS SES</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/fulltext-search">Full-text Search</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/kubernetes">Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/ipv6">IPv6</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/faq">FAQ and Tips</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/install-examples">Installation Examples</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Use Cases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docker-mailserver/usecase-forwardonly-ldap-auth">Forward-Only mailserver with LDAP authentication</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">SSL/TLS</h1></header><div class="markdown"><p>There are multiple options to enable SSL:</p><ul><li>using <a href="#lets-encrypt-recommended">letsencrypt</a> (recommended)</li><li>using <a href="#caddy">Caddy</a></li><li>using <a href="#traefik">Traefik</a></li><li>using <a href="#self-signed-certificates-testing-only">self-signed certificates</a> with the provided tool</li><li>using <a href="#custom-certificate-files">your own certificates</a></li></ul><p>After installation, you can test your setup with:</p><ul><li><a href="https://www.checktls.com/TestReceiver" target="_blank" rel="noopener noreferrer">checktls.com</a></li><li><a href="https://github.com/drwetter/testssl.sh" target="_blank" rel="noopener noreferrer">testssl.sh</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="lets-encrypt-recommended"></a>Let&#x27;s encrypt (recommended)<a class="hash-link" href="#lets-encrypt-recommended" title="Direct link to heading">#</a></h3><p>To enable Let&#x27;s Encrypt on your mail server, you have to:</p><ul><li>get your certificate using <a href="https://github.com/letsencrypt/letsencrypt" target="_blank" rel="noopener noreferrer">letsencrypt client</a></li><li>add an environment variable <code>SSL_TYPE</code> with value <code>letsencrypt</code> (see <code>docker-compose.yml.dist</code>)</li><li>mount your whole <code>letsencrypt</code> folder to <code>/etc/letsencrypt</code></li><li>the certs folder name located in <code>letsencrypt/live/</code> must be the <code>fqdn</code> of your container responding to the <code>hostname</code> command. The full qualified domain name (<code>fqdn</code>) inside the docker container is built combining the <code>hostname</code> and <code>domainname</code> values of the docker-compose file, e. g.: hostname: <code>mail</code>; domainname: <code>myserver.tld</code>; fqdn: <code>mail.myserver.tld</code></li></ul><p>You don&#x27;t have anything else to do. Enjoy.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-using-docker-for-letsencrypt"></a>Example using docker for letsencrypt<a class="hash-link" href="#example-using-docker-for-letsencrypt" title="Direct link to heading">#</a></h4><p>Make a directory to store your letsencrypt logs and configs.</p><p>In my case</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir -p /home/ubuntu/docker/letsencrypt </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cd /home/ubuntu/docker/letsencrypt</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now get the certificate (modify <code>mail.myserver.tld</code>) and following the certbot instructions.
This will need access to port 80 from the internet, adjust your firewall if needed</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --rm -ti -v $PWD/log/:/var/log/letsencrypt/ -v $PWD/etc/:/etc/letsencrypt/ -p 80:80 certbot/certbot certonly --standalone -d mail.myserver.tld</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You can now mount /home/ubuntu/docker/letsencrypt/etc/ in /etc/letsencrypt of <code>docker-mailserver</code></p><p>To renew your certificate just run (this will need access to port 443 from the internet, adjust your firewall if needed)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --rm -ti -v $PWD/log/:/var/log/letsencrypt/ -v $PWD/etc/:/etc/letsencrypt/ -p 80:80 -p 443:443 certbot/certbot renew</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-using-docker-nginx-proxy-and-letsencrypt-nginx-proxy-companion"></a>Example using docker, nginx-proxy and letsencrypt-nginx-proxy-companion<a class="hash-link" href="#example-using-docker-nginx-proxy-and-letsencrypt-nginx-proxy-companion" title="Direct link to heading">#</a></h4><p>If you are running a web server already, it is non-trivial to generate a Let&#x27;s Encrypt certificate for your mail server using <code>certbot</code>, because port 80 is already occupied. In the following example, we show how <code>docker-mailserver</code> can be run alongside the docker containers <code>nginx-proxy</code> and <code>letsencrypt-nginx-proxy-companion</code>.</p><p>There are several ways to start <code>nginx-proxy</code> and <code>letsencrypt-nginx-proxy-companion</code>. Any method should be suitable here. For example start <code>nginx-proxy</code> as in the <code>letsencrypt-nginx-proxy-companion</code> <a href="https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion" target="_blank" rel="noopener noreferrer">documentation</a>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    docker run --detach \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --name nginx-proxy \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --restart always \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --publish 80:80 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --publish 443:443 \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --volume /server/letsencrypt/etc:/etc/nginx/certs:ro \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --volume /etc/nginx/vhost.d \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --volume /usr/share/nginx/html \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        --volume /var/run/docker.sock:/tmp/docker.sock:ro \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        jwilder/nginx-proxy</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Then start <code>nginx-proxy-letsencrypt</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    docker run --detach \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      --name nginx-proxy-letsencrypt \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      --restart always \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      --volume /server/letsencrypt/etc:/etc/nginx/certs:rw \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      --volumes-from nginx-proxy \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      --volume /var/run/docker.sock:/var/run/docker.sock:ro \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      jrcs/letsencrypt-nginx-proxy-companion    </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Start the rest of your web server containers as usual.</p><p>Start another container for your <code>mail.myserver.tld</code>. This will generate a Let&#x27;s Encrypt certificate for your domain, which can be used by <code>docker-mailserver</code>. It will also run a web server on port 80 at that address.:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name webmail \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -e &quot;VIRTUAL_HOST=mail.myserver.tld&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -e &quot;LETSENCRYPT_HOST=mail.myserver.tld&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    -e &quot;LETSENCRYPT_EMAIL=foo@bar.com&quot; \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    library/nginx</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You may want to add <code>-e LETSENCRYPT_TEST=true</code> to the above while testing to avoid the Let&#x27;s Encrypt certificate generation rate limits.</p><p>Finally, start the mailserver with the docker-compose.yml
Make sure your mount path to the letsencrypt certificates is correct.
Inside your /path/to/mailserver/docker-compose.yml ( for the mailserver from this repo ) make sure volumes look like below example;</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - maildata:/var/mail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - mailstate:/var/mail-state</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - ./config/:/tmp/docker-mailserver/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - /server/letsencrypt/etc:/etc/letsencrypt/live</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Then </p><p>/path/to/mailserver/docker-compose up -d mail</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-using-docker-nginx-proxy-and-letsencrypt-nginx-proxy-companion-with-docker-compose"></a>Example using docker, nginx-proxy and letsencrypt-nginx-proxy-companion with docker-compose<a class="hash-link" href="#example-using-docker-nginx-proxy-and-letsencrypt-nginx-proxy-companion-with-docker-compose" title="Direct link to heading">#</a></h4><p>The following docker-compose.yml is the basic setup you need for using letsencrypt-nginx-proxy-companion. It is mainly derived from its own wiki/documenation.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-YAML codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">version: &quot;2&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - 80:80</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - 443:443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /mnt/data/nginx/htpasswd:/etc/nginx/htpasswd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /mnt/data/nginx/conf.d:/etc/nginx/conf.d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /mnt/data/nginx/vhost.d:/etc/nginx/vhost.d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /mnt/data/nginx/html:/usr/share/nginx/html</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /mnt/data/nginx/certs:/etc/nginx/certs:ro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    networks:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - proxy-tier</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx-gen:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: jwilder/docker-gen</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: nginx-gen</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /var/run/docker.sock:/tmp/docker.sock:ro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /mnt/data/nginx/templates/nginx.tmpl:/etc/docker-gen/templates/nginx.tmpl:ro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes_from:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    entrypoint: /usr/local/bin/docker-gen -notify-sighup nginx -watch -wait 5s:30s /etc/docker-gen/templates/nginx.tmpl /etc/nginx/conf.d/default.conf</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  letsencrypt-nginx-proxy-companion:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: jrcs/letsencrypt-nginx-proxy-companion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: letsencrypt-companion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes_from:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /var/run/docker.sock:/var/run/docker.sock:ro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /mnt/data/nginx/certs:/etc/nginx/certs:rw</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - NGINX_DOCKER_GEN_CONTAINER=nginx-gen</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - DEBUG=false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">networks:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  proxy-tier:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    external:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name: nginx-proxy</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The second part of the setup is the actual mail container. So, in another folder, create another docker-compose.yml with the following content (Removed all ENV variables for this example):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-YAML codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">version: &#x27;2&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  mail:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: tvial/docker-mailserver:latest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    hostname: ${HOSTNAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    domainname: ${DOMAINNAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    container_name: ${CONTAINER_NAME}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;25:25&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;143:143&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;465:465&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;587:587&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;993:993&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - ./mail:/var/mail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - ./mail-state:/var/mail-state</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - ./config/:/tmp/docker-mailserver/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - /mnt/data/nginx/certs/:/etc/letsencrypt/live/:ro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cap_add:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - NET_ADMIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - SYS_PTRACE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cert-companion:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;VIRTUAL_HOST=&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;VIRTUAL_NETWORK=nginx-proxy&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;LETSENCRYPT_HOST=&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - &quot;LETSENCRYPT_EMAIL=&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    networks:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - proxy-tier</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">networks:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  proxy-tier:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    external:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      name: nginx-proxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The mail container needs to have the letsencrypt certificate folder mounted as a volume. No further changes are needed. The second container is a dummy-sidecar we need, because the mail-container do not expose any web-ports. Set your ENV variables as you need. (VIRTUAL_HOST and LETSENCRYPT_HOST are mandandory, see documentation)</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-using-the-letsencrypt-certificates-on-a-synology-nas"></a>Example using the letsencrypt certificates on a Synology NAS<a class="hash-link" href="#example-using-the-letsencrypt-certificates-on-a-synology-nas" title="Direct link to heading">#</a></h4><p>Version 6.2 and later of the Synology NAS DSM OS now come with an interface to generate and renew letencrypt certificates. Navigation into your DSM control panel and go to Security, then click on the tab Certificate to generate and manage letsencrypt certificates. Amongst other things, you can use these to secure your mail server. DSM locates the generated certificates in a folder below <code>/usr/syno/etc/certificate/_archive/</code>. Navigate to that folder and note the 6 character random folder name of the certificate you&#x27;d like to use. Then, add the following to your <code>docker-compose.yml</code> declaration file:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - /usr/syno/etc/certificate/_archive/YOUR_FOLDER/:/tmp/ssl </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - SSL_TYPE=manual</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - SSL_CERT_PATH=/tmp/ssl/fullchain.pem</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      - SSL_KEY_PATH=/tmp/ssl/privkey.pem</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>DSM-generated letsencrypt certificates get auto-renewed every three months.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="caddy"></a>Caddy<a class="hash-link" href="#caddy" title="Direct link to heading">#</a></h3><p>If you are using Caddy to renew your certificates, please note that only RSA certificates work. Read <a href="https://github.com/tomav/docker-mailserver/issues/1440" target="_blank" rel="noopener noreferrer">issue 1440</a> for details. In short for Caddy v1 the Caddyfile should look something like:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">https://mail.domain.com {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    tls yourcurrentemail@gmail.com {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        key_type  rsa2048</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>For Caddy v2 you can specify the key_type in your server&#x27;s global settings, which would end up looking something like this if you&#x27;re using a Caddyfile:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">debug</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin localhost:2019</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">http_port 80</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">https_port 443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">default_sni mywebserver.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">key_type rsa4096</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If you are instead using a json config for Caddy v2, you can set it in your site&#x27;s TLS automation policies:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;apps&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;http&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;servers&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;srv0&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;listen&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;:443&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;routes&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;match&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &quot;host&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;mail.domain.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;handle&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &quot;handler&quot;: &quot;subroute&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &quot;routes&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      &quot;handle&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          &quot;body&quot;: &quot;&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          &quot;handler&quot;: &quot;static_response&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;terminal&quot;: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;tls&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;automation&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;policies&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;subjects&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;mail.domain.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;key_type&quot;: &quot;rsa2048&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;issuer&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;email&quot;: &quot;email@email.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;module&quot;: &quot;acme&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;issuer&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;email&quot;: &quot;email@email.com&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;module&quot;: &quot;acme&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The generated certificates can be mounted:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - ${CADDY_DATA_DIR}/certificates/acme-v02.api.letsencrypt.org-directory/mail.domain.com/mail.domain.com.crt:/etc/letsencrypt/live/mail.domain.com/fullchain.pem</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - ${CADDY_DATA_DIR}/certificates/acme-v02.api.letsencrypt.org-directory/mail.domain.com/mail.domain.com.key:/etc/letsencrypt/live/mail.domain.com/privkey.pem</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>EC certificates fail in the TLS handshake:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">CONNECTED(00000003)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">140342221178112:error:14094410:SSL routines:ssl3_read_bytes:sslv3 alert handshake failure:ssl/record/rec_layer_s3.c:1543:SSL alert number 40</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">no peer certificate available</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">No client certificate CA names sent</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="traefik"></a>Traefik<a class="hash-link" href="#traefik" title="Direct link to heading">#</a></h3><p><a href="https://github.com/containous/traefik" target="_blank" rel="noopener noreferrer">Traefik</a> is an open-source Edge Router which handles ACME protocol using <a href="https://github.com/go-acme/lego" target="_blank" rel="noopener noreferrer">lego</a>.</p><p>Traefik can request certificates for domains through the ACME protocol (see <a href="https://docs.traefik.io/https/acme/" target="_blank" rel="noopener noreferrer">Traefik&#x27;s documentation about its ACME negotiation &amp; storage mechanism</a>). Traefik&#x27;s router will take care of renewals, challenge negotiations, etc.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="traefik-v2"></a>Traefik v2<a class="hash-link" href="#traefik-v2" title="Direct link to heading">#</a></h5><p>(For Traefik v1 see <a href="#traefik-v1">next section</a>)</p><p>Traefik&#x27;s V2 storage format is natively supported if the <code>acme.json</code> store is mounted into the container at <code>/etc/letsencrypt/acme.json</code>. The file is also monitored for changes and will trigger a reload of the mail services. Lookup of the certificate domain happens in the following order:</p><ol><li>$SSL_DOMAIN</li><li>$HOSTNAME</li><li>$DOMAINNAME</li></ol><p>This allows for support of wild card certificates: <code>&quot;SSL_DOMAIN=*.example.com&quot;</code>. Here is an example setup for <a href="https://docs.docker.com/compose/" target="_blank" rel="noopener noreferrer">docker-compose</a>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-YAML codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">version: &#x27;3.8&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  mail:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: tvial/docker-mailserver:stable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    hostname: mail</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    domainname: example.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - /etc/ssl/acme-v2.json:/etc/letsencrypt/acme.json:ro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      SSL_TYPE: letsencrypt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      # SSL_DOMAIN: &quot;*.example.com&quot; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  traefik:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: traefik:v2.2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    restart: always</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;80:80&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;443:443&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    command:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --providers.docker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --entrypoints.web.address=:80</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --entrypoints.web.http.redirections.entryPoint.to=websecure</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --entrypoints.web.http.redirections.entryPoint.scheme=https</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --entrypoints.websecure.address=:443</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --entrypoints.websecure.http.middlewares=hsts@docker</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --entrypoints.websecure.http.tls.certResolver=le</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --certificatesresolvers.le.acme.email=admin@example.net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --certificatesresolvers.le.acme.storage=/acme.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - --certificatesresolvers.le.acme.httpchallenge.entrypoint=web</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - /var/run/docker.sock:/var/run/docker.sock:ro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - /etc/ssl/acme-v2.json:/acme.json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  whoami:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    image: containous/whoami</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;traefik.http.routers.whoami.rule=Host(`mail.example.com`)&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This setup only comes with one caveat: The domain has to be configured on another service for traefik to actually request it from lets-encrypt (<code>whoami</code> in this case).</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="traefik-v1"></a>Traefik V1<a class="hash-link" href="#traefik-v1" title="Direct link to heading">#</a></h5><p>If you are using Traefik v1, you might want to <em>push</em> your Traefik-managed certificates to the mailserver container, in order to reuse them. Not an easy task, but fortunately, <a href="https://github.com/youtous/docker-mailserver-traefik" target="_blank" rel="noopener noreferrer">youtous/mailserver-traefik</a> is a certificate renewal service for docker-mailserver.</p><p>Depending of your Traefik configuration, certificates may be stored using a file or a KV Store (consul, etcd...) Either way, certificates will be renewed by Traefik, then automatically pushed to the mailserver thanks to the cert-renewer service. Finally, dovecot and postfix will be restarted.</p><p>Documentation: <a href="https://github.com/youtous/docker-mailserver-traefik" target="_blank" rel="noopener noreferrer">https://github.com/youtous/docker-mailserver-traefik</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="self-signed-certificates-testing-only"></a>Self-signed certificates (testing only)<a class="hash-link" href="#self-signed-certificates-testing-only" title="Direct link to heading">#</a></h3><p>You can easily generate a self-signed SSL certificate by using the following command:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -ti --rm -v &quot;$(pwd)&quot;/config/ssl:/tmp/docker-mailserver/ssl -h mail.my-domain.com -t tvial/docker-mailserver generate-ssl-certificate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Press enter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Enter a password when needed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Fill information like Country, Organisation name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Fill &quot;my-domain.com&quot; as FQDN for CA, and &quot;mail.my-domain.com&quot; for the certificate.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># They HAVE to be different, otherwise you&#x27;ll get a `TXT_DB error number 2`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Don&#x27;t fill extras</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Enter same password when needed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Sign the certificate? [y/n]:y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># 1 out of 1 certificate requests certified, commit? [y/n]y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># will generate:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># config/ssl/mail.my-domain.com-key.pem (used in postfix)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># config/ssl/mail.my-domain.com-req.pem (only used to generate other files)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># config/ssl/mail.my-domain.com-cert.pem (used in postfix)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># config/ssl/mail.my-domain.com-combined.pem (used in courier)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># config/ssl/demoCA/cacert.pem (certificate authority)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that the certificate will be generate for the container <code>fqdn</code>, that is passed as <code>-h</code> argument.
Check the following page for more information regarding <a href="http://www.mad-hacking.net/documentation/linux/applications/mail/using-ssl-tls-postfix-courier.xml" target="_blank" rel="noopener noreferrer">postfix and SSL/TLS configuration</a>.</p><p>To use the certificate:</p><ul><li>add <code>SSL_TYPE=self-signed</code> to your container environment variables</li><li>if a matching certificate (files listed above) is found in <code>config/ssl</code>, it will be automatically setup in postfix and dovecot. You just have to place them in <code>config/ssl</code> folder.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="custom-certificate-files"></a>Custom certificate files<a class="hash-link" href="#custom-certificate-files" title="Direct link to heading">#</a></h3><p>You can also provide your own certificate files. Add these entries to your <code>docker-compose.yml</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - /etc/ssl:/tmp/ssl:ro</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- SSL_TYPE=manual</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- SSL_CERT_PATH=/tmp/ssl/cert/public.crt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- SSL_KEY_PATH=/tmp/ssl/private/private.key</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will mount the path where your ssl certificates reside as read-only under <code>/tmp/ssl</code>. Then all you have to do is to specify the location of your private key and the certificate.</p><p>Please note that you may have to restart your mailserver once the certificates change.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="testing-certificate"></a>Testing certificate<a class="hash-link" href="#testing-certificate" title="Direct link to heading">#</a></h3><p>From your host:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker exec mail openssl s_client -connect 0.0.0.0:25 -starttls smtp -CApath /etc/ssl/certs/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>or</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker exec mail openssl s_client -connect 0.0.0.0:143 -starttls imap -CApath /etc/ssl/certs/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And you should see the certificate chain, the server certificate and:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Verify return code: 0 (ok)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In addition, to verify certificate dates:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker exec mail openssl s_client -connect 0.0.0.0:25 -starttls smtp -CApath /etc/ssl/certs/ 2&gt;/dev/null | openssl x509 -noout  -dates</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="plain-text-access"></a>Plain text access<a class="hash-link" href="#plain-text-access" title="Direct link to heading">#</a></h3><p>Not recommended for purposes other than testing.</p><p>Just add this to config/dovecot.cf:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssl = yes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">disable_plaintext_auth=no</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>These options in conjunction mean:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ssl=yes and disable_plaintext_auth=no: SSL/TLS is offered to the client, but the client isn&#x27;t required to use it. The client is allowed to login with plaintext authentication even when SSL/TLS isn&#x27;t enabled on the connection. This is insecure, because the plaintext password is exposed to the internet.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="importing-certificates-obtained-via-another-source"></a>Importing certificates obtained via another source<a class="hash-link" href="#importing-certificates-obtained-via-another-source" title="Direct link to heading">#</a></h3><p>If you have another source for SSL/TLS certificates you can import them into the server via an external script. The external script can be found here: <a href="https://github.com/hanscees/dockerscripts/blob/master/scripts/tomav-renew-certs" target="_blank" rel="noopener noreferrer">external certificate import script</a></p><p>The steps to follow are these:</p><ol><li>Transport the new certificates to ./config/sll (/tmp/ssl in the container)</li><li>You should provide fullchain.key and privkey.pem</li><li>Place the script in ./config/  (or /tmp/docker-mailserver/ inside the container)</li><li>Make the script executable (chmod +x tomav-renew-certs.sh )</li><li>Run the script: docker exec mail /tmp/docker-mailserver/tomav-renew-certs.sh</li></ol><p>If an error occurs the script will inform you. If not you will see both postfix and dovecot restart.</p><p>After the certificates have been loaded you can check the certificate: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">openssl s_client -servername mail.mydomain.net -connect 192.168.0.72:465 2&gt;/dev/null | openssl x509</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># or </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">openssl s_client -servername mail.mydomain.net -connect mail.mydomain.net:465 2&gt;/dev/null | openssl x509</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Or you can check how long the new certificate is valid with commands like:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">export SITE_URL=&quot;mail.mydomain.net&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export SITE_IP_URL=&quot;192.168.0.72&quot;  ## can also be  mail.mydomain.net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export SITE_SSL_PORT=&quot;465&quot;  ##imap port dovecot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##works: check if certificate will expire in two weeks </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#2 weeks is 1209600 seconds</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#3 weeks is 1814400</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#12 weeks is 7257600</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#15 weeks is 9072000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">certcheck_2weeks=`openssl s_client -connect ${SITE_IP_URL}:${SITE_SSL_PORT} \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -servername ${SITE_URL} 2&gt; /dev/null |  openssl x509 -noout  -checkend 1209600`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#notes:  output can be </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#Certificate will not expire</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#Certificate will expire</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>What does the script that imports the certificates do:</p><ol><li>Check if there are new certs in the /tmp/ssl folder</li><li>check with the ssl cert fingerprint if they differ from the current certificates</li><li>if so it will copy the certs to the right places</li><li>and restart postfix and dovecot </li></ol><p>You can ofcourse run the script by cron once a week or something. In that way you could automate cert renewal. If you do so it is probably wise to run an automated check on certificate expiry as well. Such a check could look something like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## code below will alert if certificate expires in less than two weeks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## please adjust varables! </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## make sure the mail -s command works! Test!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export SITE_URL=&quot;mail.mydomain.net&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export SITE_IP_URL=&quot;192.168.2.72&quot;  ## can also be  mail.mydomain.net</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export SITE_SSL_PORT=&quot;465&quot;  ##imap port dovecot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export ALERT_EMAIL_ADDR=&quot;bill@gates321boom.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">certcheck_2weeks=`openssl s_client -connect ${SITE_IP_URL}:${SITE_SSL_PORT} \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  -servername ${SITE_URL} 2&gt; /dev/null |  openssl x509 -noout  -checkend 1209600`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####################################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#notes:  output can be </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#Certificate will not expire</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#Certificate will expire</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">####################</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#echo &quot;certcheck 2 weeks gives $certcheck_2weeks&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">##automated check you might run by cron or something</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## does tls/ssl certificate expire within two weeks?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if [  &quot;$certcheck_2weeks&quot; = &quot;Certificate will not expire&quot; ]; then </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  echo &quot;all is wel, certwatch 2 weeks says $certcheck_2weeks&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   echo &quot;Cert seems to be expiring pretty soon, within two weeks: $certcheck_2weeks&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   echo &quot;we will send an alert email and log as well&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   logger Certwatch: cert $SITE_URL will expire in two weeks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   echo &quot;Certwatch: cert $SITE_URL will expire in two weeks&quot; | mail -s &quot;cert $SITE_URL expires in two weeks &quot; $ALERT_EMAIL_ADDR </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/polarathene/docker-mailserver/tree/docs/docusaurus-demo/website/docs/Configure-SSL.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docker-mailserver/understanding-ports"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Understanding the ports</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docker-mailserver/config-fail2ban"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configure Fail2Ban Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lets-encrypt-recommended" class="table-of-contents__link">Let&#39;s encrypt (recommended)</a></li><li><a href="#caddy" class="table-of-contents__link">Caddy</a></li><li><a href="#traefik" class="table-of-contents__link">Traefik</a></li><li><a href="#self-signed-certificates-testing-only" class="table-of-contents__link">Self-signed certificates (testing only)</a></li><li><a href="#custom-certificate-files" class="table-of-contents__link">Custom certificate files</a></li><li><a href="#testing-certificate" class="table-of-contents__link">Testing certificate</a></li><li><a href="#plain-text-access" class="table-of-contents__link">Plain text access</a></li><li><a href="#importing-certificates-obtained-via-another-source" class="table-of-contents__link">Importing certificates obtained via another source</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Â© <a href="https://github.com/docker-mailserver"><em>Docker Mailserver Organization</em></a><br>This project is licensed under the MIT license.</div></div></div></footer></div>
<script src="/docker-mailserver/styles.0a2c2036.js"></script>
<script src="/docker-mailserver/runtime~main.528323d4.js"></script>
<script src="/docker-mailserver/main.e93513c9.js"></script>
<script src="/docker-mailserver/1.a0b7a12a.js"></script>
<script src="/docker-mailserver/2.2c4bde7c.js"></script>
<script src="/docker-mailserver/36.56e87f6c.js"></script>
<script src="/docker-mailserver/935f2afb.1219889f.js"></script>
<script src="/docker-mailserver/17896441.7b889dd7.js"></script>
<script src="/docker-mailserver/7e14cee2.34510799.js"></script>
</body>
</html>