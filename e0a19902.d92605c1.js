(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{117:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(3),i=n(7),r=(n(0),n(125)),o={id:"introduction",title:"An Introduction to Mail Servers"},s={unversionedId:"introduction",id:"introduction",isDocsHomePage:!1,title:"An Introduction to Mail Servers",description:"What is a mail server and how does it perform its duty?",source:"@site/docs/Introduction.md",slug:"/introduction",permalink:"/docker-mailserver/docs/introduction",editUrl:"https://github.com/polarathene/docker-mailserver/tree/docs/docusaurus-demo/website/docs/Introduction.md",version:"current",sidebar:"docs",previous:{title:"Home",permalink:"/docker-mailserver/docs/"},next:{title:"Your best friend setup.sh",permalink:"/docker-mailserver/docs/setupsh"}},l=[{value:"Anatomy of a mail server",id:"anatomy-of-a-mail-server",children:[]},{value:"Components",id:"components",children:[]},{value:"About security &amp; ports",id:"about-security--ports",children:[{value:"Submission - SMTP",id:"submission---smtp",children:[]},{value:"Retrieval - IMAP",id:"retrieval---imap",children:[]},{value:"Retrieval - POP3",id:"retrieval---pop3",children:[]}]},{value:"How does <code>docker-mailserver</code> help with setting everything up?",id:"how-does-docker-mailserver-help-with-setting-everything-up",children:[]}],c={toc:l};function p(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"What is a mail server and how does it perform its duty?",Object(r.b)("br",{parentName:"p"}),"\n","Here's an introduction to the field that covers everything you need to know to get started with ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"."),Object(r.b)("h2",{id:"anatomy-of-a-mail-server"},"Anatomy of a mail server"),Object(r.b)("p",null,"A mail server is only a part of a ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Client%E2%80%93server_model"},"client-server relationship")," aimed at exchanging information in the form of ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Email"},"emails"),". Exchanging emails requires using specific means (programs and protocols)."),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," provides you with the server portion, whereas the client can be anything from a terminal via text-based software (eg. ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Mutt_(email_client)"},"Mutt"),") to a fully-fledged desktop application (eg. ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Mozilla_Thunderbird"},"Mozilla Thunderbird"),", ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Microsoft_Outlook"},"Microsoft Outlook"),"\u2026), to a web interface, etc."),Object(r.b)("p",null,'Unlike the client-side where usually a single program is used to perform retrieval and viewing of emails, the server-side is composed of many specialized components. The mail server is capable of accepting, forwarding, delivering, storing and overall exchanging messages, but each one of those tasks is actually handled by a specific piece of software. All of these "agents" must be integrated with one another for the exchange to take place.'),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," has made informed choices about those components and their (default) configuration. It offers a comprehensive platform to run a fully featured mail server in no time!"),Object(r.b)("h2",{id:"components"},"Components"),Object(r.b)("p",null,"The following components are required to create a ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Email_agent_(infrastructure)"},"complete delivery chain"),":"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"MUA: a ",Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Email_client"},"Mail User Agent")," is basically any client/program capable of sending emails to arbitrary mail servers; while also capable of fetching emails from mail servers for presenting them to the end users."),Object(r.b)("li",{parentName:"ul"},"MTA: a ",Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Message_transfer_agent"},"Mail Transfer Agent")," is the so-called \"mail server\" as seen from the MUA's perspective. It's a piece of software dedicated to accepting submitted emails, then forwarding them-where exactly will depend on an email's final destination. If the receiving MTA is responsible for the hostname the email is sent to, then an MTA is to forward that email to an MDA (see below). Otherwise, it is to transfer (ie. forward, relay) to another MTA, \"closer\" to the email's final destination."),Object(r.b)("li",{parentName:"ul"},"MDA: a ",Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Mail_delivery_agent"},"Mail Delivery Agent")," is responsible for accepting emails from an MTA and dropping them into their recipients' mailboxes, whichever the form.")),Object(r.b)("p",null,"Here's a schematic view of mail delivery:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-txt"},"Sending an email:    MUA ----\x3e MTA ----\x3e (MTA relays) ----\x3e MDA\nFetching an email:   MUA <--------------------------------- MDA\n")),Object(r.b)("p",null,"There may be other moving parts or sub-divisions (for instance, at several points along the chain, specialized programs may be analyzing, filtering, bouncing, editing\u2026 the exchanged emails)."),Object(r.b)("p",null,"In a nutshell, ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," provides you with the following components:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"A MTA: ",Object(r.b)("a",{parentName:"li",href:"http://www.postfix.org/"},"Postfix")),Object(r.b)("li",{parentName:"ul"},"A MDA: ",Object(r.b)("a",{parentName:"li",href:"https://dovecot.org/"},"Dovecot")),Object(r.b)("li",{parentName:"ul"},"A bunch of additional programs to improve security and emails processing")),Object(r.b)("p",null,"Here's where ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"'s toochain fits within the delivery chain:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-txt"},"                                    docker-mailserver is here:\n                                                         \u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\nSending an email:    MUA ---\x3e MTA ---\x3e (MTA relays) ---\x3e \u252b MTA \u256e \u2503\nFetching an email:   MUA <------------------------------ \u252b MDA \u256f \u2503\n                                                         \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Let's say Alice owns a Gmail account, ",Object(r.b)("inlineCode",{parentName:"p"},"alice@gmail.com"),"; and Bob owns an account on a ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"'s instance, ",Object(r.b)("inlineCode",{parentName:"p"},"bob@dms.io"),"."),Object(r.b)("p",{parentName:"blockquote"},"Make sure not to conflate these two very different scenarios:\nA) Alice sends an email to ",Object(r.b)("inlineCode",{parentName:"p"},"bob@dms.io")," => the email is first submitted to MTA ",Object(r.b)("inlineCode",{parentName:"p"},"smtp.gmail.com"),", then relayed to MTA ",Object(r.b)("inlineCode",{parentName:"p"},"smtp.dms.io")," where it is then delivered into Bob's mailbox.\nB) Bob sends an email to ",Object(r.b)("inlineCode",{parentName:"p"},"alice@gmail.com")," => the email is first submitted to MTA ",Object(r.b)("inlineCode",{parentName:"p"},"smtp.dms.io"),", then relayed to MTA ",Object(r.b)("inlineCode",{parentName:"p"},"smtp.gmail.com")," and eventually delivered into Alice's mailbox."),Object(r.b)("p",{parentName:"blockquote"},"In scenario ",Object(r.b)("em",{parentName:"p"},"A")," the email leaves Gmail's premises, that email's ",Object(r.b)("em",{parentName:"p"},"initial")," submission is ",Object(r.b)("em",{parentName:"p"},"not")," handled by your ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," instance(MTA); it merely receives the email after it has been relayed by Gmail's MTA. In scenario ",Object(r.b)("em",{parentName:"p"},"B"),", the ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," instance(MTA) handles the submission, prior to relaying."),Object(r.b)("p",{parentName:"blockquote"},"The main takeaway is that when a third-party sends an email to a ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," instance(MTA) (or any MTA for that matter), it does ",Object(r.b)("em",{parentName:"p"},"not")," establish a direct connection with that MTA. Email submission first goes through the sender's MTA, then some relaying between at least two MTAs is required to deliver the email. That will prove very important when it comes to security management.")),Object(r.b)("p",null,"One important thing to note is that MTA and MDA programs may actually handle ",Object(r.b)("em",{parentName:"p"},"multiple")," tasks (which is the case with ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"'s Postfix and Dovecot)."),Object(r.b)("p",null,"For instance, Postfix is both an SMTP server (accepting emails) and a relaying MTA (transferring, ie. sending emails to other MTA/MDA); Dovecot is both an MDA (delivering emails in mailboxes) and an IMAP server (allowing MUAs to fetch emails from the ",Object(r.b)("em",{parentName:"p"},"mail server"),"). On top of that, Postfix may rely on Dovecot's authentication capabilities."),Object(r.b)("p",null,"The exact relationship between all the components and their respective (sometimes shared) responsibilities is beyond the scope of this document. Please explore this wiki & the web to get more insights about ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"'s toolchain."),Object(r.b)("h2",{id:"about-security--ports"},"About security & ports"),Object(r.b)("p",null,"In the previous section, different components were outlined. Each one of those is responsible for a specific task, it has a specific purpose."),Object(r.b)("p",null,"Three main purposes exist when it comes to exchanging emails:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"Submission"),": for a MUA (client), the act of sending actual email data over the network, toward an MTA (server)."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"Transfer")," (aka. ",Object(r.b)("em",{parentName:"li"},"Relay"),"): for an MTA, the act of sending actual email data over the network, toward another MTA (server) closer to the final destination (where an MTA will forward data to an MDA)."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("em",{parentName:"li"},"Retrieval"),": for a MUA (client), the act of fetching actual email data over the network, from an MDA.")),Object(r.b)("p",null,"Postfix handles Submission (and might handle Relay), whereas Dovecot handles Retrieval. They both need to be accessible by MUAs in order to act as servers, therefore they expose public endpoints on specific TCP ports (see. ",Object(r.b)("a",{parentName:"p",href:"https://github.com/tomav/docker-mailserver/wiki/Understanding-the-ports"},Object(r.b)("em",{parentName:"a"},"Understanding the ports"))," for more details). Those endpoints ",Object(r.b)("em",{parentName:"p"},"may")," be secured, using an encryption scheme and TLS certificates."),Object(r.b)("p",null,"When it comes to the specifics of email exchange, we have to look at protocols and ports enabled to support all the identified purposes. There are several valid options and they've been evolving overtime."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Here's ",Object(r.b)("inlineCode",{parentName:"strong"},"docker-mailserver"),"'s ",Object(r.b)("em",{parentName:"strong"},"default")," configuration:")),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Purpose"),Object(r.b)("th",{parentName:"tr",align:null},"Protocol"),Object(r.b)("th",{parentName:"tr",align:null},"TCP port / encryption"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"Transfer/Relay"),Object(r.b)("td",{parentName:"tr",align:null},"SMTP"),Object(r.b)("td",{parentName:"tr",align:null},"25 (unencrypted)")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"Submission"),Object(r.b)("td",{parentName:"tr",align:null},"ESMTP"),Object(r.b)("td",{parentName:"tr",align:null},"587 (encrypted using STARTTLS)")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"Retrieval"),Object(r.b)("td",{parentName:"tr",align:null},"IMAP4"),Object(r.b)("td",{parentName:"tr",align:null},"143 (encrypted using STARTTLS) + 993 (TLS)")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"Retrieval"),Object(r.b)("td",{parentName:"tr",align:null},"POP3"),Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("em",{parentName:"td"},"Not activated"))))),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-txt"}," \u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 Submission \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 Transfer/Relay \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2510\nMUA ----- STARTTLS ---\x3e \u2524(587)   MTA \u256e    (25)\u251c <-- cleartext ---\x3e \u250a Third-party MTA \u250a\n    ---- cleartext ---\x3e \u2524(25)        \u2502        |                    \u2514\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2518\n                        |\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504|\nMUA <---- STARTTLS ---- \u2524(143)   MDA \u256f        |\n    <-- enforced TLS -- \u2524(993)                |\n                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 Retrieval \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n")),Object(r.b)("p",null,"If you're new to email infrastructure, both that table and the schema may be confusing.",Object(r.b)("br",{parentName:"p"}),"\n","Read on to expand your understanding and learn about ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"'s configuration, including how you can customize it."),Object(r.b)("h3",{id:"submission---smtp"},"Submission - SMTP"),Object(r.b)("p",null,"For a MUA to send an email to an MTA, it needs to establish a connection with that server, then push data packets over a network that both the MUA (client) and the MTA (server) are connected to. The server implements the ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol"},"SMTP")," protocol, which makes it capable of handling ",Object(r.b)("em",{parentName:"p"},"Submission"),"."),Object(r.b)("p",null,"In the case of ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),", the MTA (SMTP server) is Postfix. The MUA (client) may vary, yet its Submission request is performed as ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Transmission_Control_Protocol"},"TCP")," packets sent over the ",Object(r.b)("em",{parentName:"p"},"public")," internet. This exchange of information may be secured in order to counter eavesdropping."),Object(r.b)("h4",{id:"two-kinds-of-submission"},"Two kinds of Submission"),Object(r.b)("p",null,"Let's say I own an account on a ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," instance, ",Object(r.b)("inlineCode",{parentName:"p"},"me@dms.io"),". There are two very different use-cases for Submission:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"I want to send an email to someone"),Object(r.b)("li",{parentName:"ol"},"Someone wants to send you an email")),Object(r.b)("p",null,"In the first scenario, I will be submitting my email directly to my ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," instance/MTA (Postfix), which will then relay the email to its recipient's MTA for final delivery. In this case, Submission is first handled by establishing a direct connection to my own MTA-so at least for this portion of the delivery chain, I'll be able to ensure security/confidentiality. Not so much for what comes next, ie. relaying between MTAs and final delivery."),Object(r.b)("p",null,'In the second scenario, a third-party email account owner will be first submitting an email to some third-party MTA. I have no control over this initial portion of the delivery chain, nor do I have control over the relaying that comes next. My MTA will merely accept a relayed email coming "out of the blue".'),Object(r.b)("p",null,"My MTA will thus have to support two kinds of Submission:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},'Outward Submission (self-owned email is submitted directly to the MTA, then is relayed "outside")'),Object(r.b)("li",{parentName:"ul"},'Inward Submission (third-party email has been submitted & relayed, then is accepted "inside" by the MTA)')),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-txt"}," \u250f\u2501\u2501\u2501\u2501 Outward Submission \u2501\u2501\u2501\u2501\u2513\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2510\nMe ---------------\x3e \u2524                    \u251c -----------------\x3e \u250a                 \u250a\n                    \u2502       My MTA       \u2502                    \u250a Third-party MTA \u250a\n                    \u2502                    \u251c <----------------- \u250a                 \u250a\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2518\n                               \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 Inward Submission \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n")),Object(r.b)("h5",{id:"outward-submission"},"Outward Submission"),Object(r.b)("p",null,"The best practice as of 2020 when it comes to securing Outward Submission is to use ",Object(r.b)("em",{parentName:"p"},"Implicit TLS connection via ESMTP on port 465")," (see ",Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc8314"},"RFC 8314"),"). Let's break it down."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Implicit TLS means the server ",Object(r.b)("em",{parentName:"li"},"enforces")," the client into using an encrypted TCP connection, using ",Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Transport_Layer_Security"},"TLS"),". With this kind of connection, the MUA ",Object(r.b)("em",{parentName:"li"},"has"),' to establish a TLS-encrypted connection from the get go (TLS is implied, hence the name "Implicit"). Any client attempting to either submit email in cleartext (unencrypted, not secure), or requesting a cleartext connection to be upgraded to a TLS-encrypted one using ',Object(r.b)("inlineCode",{parentName:"li"},"STARTTLS"),", is to be denied. Implicit TLS is sometimes called Enforced TLS for that reason."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/ESMTP"},"ESMTP")," is ",Object(r.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol"},"SMTP")," + extensions. It's the version of the SMTP protocol that most mail servers speak nowadays. For the purpose of this documentation, ESMTP and SMTP are synonymous."),Object(r.b)("li",{parentName:"ul"},"Port 465 is the reserved TCP port for Implicit TLS Submission (since 2018). There is actually a boisterous history to that ports usage, but let's keep it simple.")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Note: This Submission setup is sometimes refered to as ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/SMTPS"},"SMTPS"),". Long story short: this is incorrect and should be avoided.")),Object(r.b)("p",null,'Although a very satisfactory setup, Implicit TLS on port 465 is somewhat "cutting edge". There exists another well established mail Submission setup that must be supported as well, SMTP+STARTTLS on port 587. It uses Explicit TLS: the client starts with a cleartext connection, then the server informs a TLS-encrypted "upgraded" connection may be established, and the client ',Object(r.b)("em",{parentName:"p"},"may")," eventually decide to establish it prior to the Submission. Basically it's an opportunistic, opt-in TLS upgrade of the connection between the client and the server, at the client's discretion, using a mechanism known as ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Opportunistic_TLS"},"STARTTLS")," that both ends need to implement."),Object(r.b)("p",null,"In many implementations, the mail server doesn't enforce TLS encryption, for backwards compatibility. Clients are thus free to deny the TLS-upgrade proposal (or ",Object(r.b)("a",{parentName:"p",href:"https://security.stackexchange.com/questions/168998/what-happens-if-starttls-dropped-in-smtp"},"misled by a hacker")," about STARTTLS not being available), and the server accepts unencrypted (cleartext) mail exchange, which poses a confidentiality threat and, to some extent, spam issues. ",Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc8314"},"RFC 8314 (section 3.3)")," recommends for mail servers to support both Implicit and Explicit TLS for Submission, ",Object(r.b)("em",{parentName:"p"},"and")," to enforce TLS-encryption on ports 587 (Explicit TLS) and 465 (Implicit TLS). That's exactly ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"'s default configuration: abiding by RFC 8314, it ",Object(r.b)("a",{parentName:"p",href:"http://www.postfix.org/postconf.5.html#smtpd_tls_security_level"},"enforces a strict (",Object(r.b)("inlineCode",{parentName:"a"},"encrypt"),") STARTTLS policy"),", where a denied TLS upgrade terminates the connection thus (hopefully but at the client's discretion) preventing unencrypted (cleartext) Submission."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"docker-mailserver"),"'s default configuration enables and ",Object(r.b)("em",{parentName:"strong"},"requires")," Explicit TLS (STARTTLS) on port 587 for Outward Submission.")),Object(r.b)("li",{parentName:"ul"},"It does not enable Implicit TLS Outward Submission on port 465 by default. One may enable it through simple custom configuration, either as a replacement or (better!) supplementary mean of secure Submission."),Object(r.b)("li",{parentName:"ul"},"It does not support old MUAs (clients) not supporting TLS encryption on ports 587/465 (those should perform Submission on port 25, more details below). One may relax that constraint through advanced custom configuration, for backwards compatibility.")),Object(r.b)("p",null,"A final Outward Submission setup exists and is akin SMTP+STARTTLS on port 587, but on port 25. That port has historically been reserved specifically for unencrypted (cleartext) mail exchange though, making STARTTLS a bit wrong to use. As is expected by ",Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc5321"},"RFC 5321"),", ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," uses port 25 for unencrypted Submission in order to support older clients, but most importantly for unencrypted Transfer/Relay between MTAs."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"docker-mailserver"),"'s default configuration also enables unencrypted (cleartext) on port 25 for Outward Submission.")),Object(r.b)("li",{parentName:"ul"},"It does not enable Explicit TLS (STARTTLS) on port 25 by default. One may enable it through advanced custom configuration, either as a replacement (bad!) or as a supplementary mean of secure Outward Submission."),Object(r.b)("li",{parentName:"ul"},"One may also secure Outward Submission using advanced encryption scheme, such as DANE/DNSSEC and/or MTA-STS.")),Object(r.b)("h5",{id:"inward-submission"},"Inward Submission"),Object(r.b)("p",null,"Granted it's still very difficult enforcing encryption between MTAs (Transfer/Relay) without risking dropping emails (when relayed by MTAs not supporting TLS-encryption), Inward Submission is to be handled in cleartext on port 25 by default."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"strong"},"docker-mailserver"),"'s default configuration enables unencrypted (cleartext) on port 25 for Inward Submission.")),Object(r.b)("li",{parentName:"ul"},"It does not enable Explicit TLS (STARTTLS) on port 25 by default. One may enable it through advanced custom configuration, either as a replacement (bad!) or as a supplementary mean of secure Inward Submission."),Object(r.b)("li",{parentName:"ul"},"One may also secure Inward Submission using advanced encryption scheme, such as DANE/DNSSEC and/or MTA-STS.")),Object(r.b)("p",null,"Overall, ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"'s default configuration for SMTP looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-txt"}," \u250f\u2501\u2501\u2501\u2501 Outward Submission \u2501\u2501\u2501\u2501\u2513\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2510\nMe -- cleartext --\x3e \u2524(25)            (25)\u251c --- cleartext ---\x3e \u250a                 \u250a\nMe -- STARTTLS ---\x3e \u2524(587)  My MTA       \u2502                    \u250a Third-party MTA \u250a\n                    \u2502                (25)\u251c <---cleartext ---- \u250a                 \u250a\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2504\u2518\n                               \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501 Inward Submission \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\n")),Object(r.b)("h3",{id:"retrieval---imap"},"Retrieval - IMAP"),Object(r.b)("p",null,"A MUA willing to fetch an email from a mail server will most likely communicate with its ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/IMAP"},"IMAP")," server. As with SMTP described earlier, communication will take place in the form of data packets exchanged over a network that both the client and the server are connected to. The IMAP protocol makes the server capable of handling ",Object(r.b)("em",{parentName:"p"},"Retrieval"),"."),Object(r.b)("p",null,"In the case of ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),", the IMAP server is Dovecot. The MUA (client) may vary, yet its Retrieval request is performed as ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Transmission_Control_Protocol"},"TCP")," packets sent over the ",Object(r.b)("em",{parentName:"p"},"public")," internet. This exchange of information may be secured in order to counter eavesdropping."),Object(r.b)("p",null,"Again, as with SMTP described earlier, the IMAP protocol may be secured with either Implicit TLS (aka. ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/IMAPS"},"IMAPS"),"/IMAP4S) or Explicit TLS (using STARTTLS)."),Object(r.b)("p",null,"The best practice as of 2020 is to enforce IMAPS on port 993, rather than IMAP+STARTTLS on port 143 (see ",Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc8314"},"RFC 8314"),"); yet the latter is usually provided for backwards compatibility."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"strong"},"docker-mailserver"),"'s default configuration enables both Implicit and Explicit TLS for Retrievial, on ports 993 and 143 respectively.")),Object(r.b)("h3",{id:"retrieval---pop3"},"Retrieval - POP3"),Object(r.b)("p",null,"Similarly to IMAP, the older POP3 protocol may be secured with either Implicit or Explicit TLS."),Object(r.b)("p",null,"The best practice as of 2020 would be ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/POP3S"},"POP3S")," on port 995, rather than ",Object(r.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/POP3"},"POP3"),"+STARTTLS on port 110 (see ",Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc8314"},"RFC 8314"),")."),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"strong"},"docker-mailserver"),"'s default configuration disables POP3 altogether.")," One should expect MUAs to use TLS-encrypted IMAP for Retrieval."),Object(r.b)("h2",{id:"how-does-docker-mailserver-help-with-setting-everything-up"},"How does ",Object(r.b)("inlineCode",{parentName:"h2"},"docker-mailserver")," help with setting everything up?"),Object(r.b)("p",null,"As a ",Object(r.b)("em",{parentName:"p"},"batteries included")," Docker image, ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver")," provides you with all the required components and a default configuration, to run a decent and secure mail server."),Object(r.b)("p",null,"One may then customize all aspects of its internal components."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Simple customization is supported through ",Object(r.b)("a",{parentName:"li",href:"https://github.com/tomav/docker-mailserver/blob/master/docker-compose.yml.dist"},"docker-compose configuration")," and the ",Object(r.b)("a",{parentName:"li",href:"https://github.com/tomav/docker-mailserver/blob/master/env-mailserver.dist"},"env-mailserver")," configuration file."),Object(r.b)("li",{parentName:"ul"},'Advanced customization is supported through providing "monkey-patching" configuration files and/or ',Object(r.b)("a",{parentName:"li",href:"https://github.com/tomav/docker-mailserver/blob/master/Dockerfile"},"deriving your own image")," from ",Object(r.b)("inlineCode",{parentName:"li"},"docker-mailserver"),"'s upstream, for a complete control over how things run.")),Object(r.b)("p",null,"On the subject of security, one might consider ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),"'s ",Object(r.b)("strong",{parentName:"p"},"default")," configuration to ",Object(r.b)("em",{parentName:"p"},"not")," be 100% secure:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"it enables unencrypted traffic on port 25"),Object(r.b)("li",{parentName:"ul"},"it enables Explicit TLS (STARTTLS) on port 587, instead of Implicit TLS on port 465")),Object(r.b)("p",null,"We believe ",Object(r.b)("inlineCode",{parentName:"p"},"docker-mailserver"),'\'s default configuration to be a good middle ground: it goes slightly beyond "old" (1999) ',Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc2487"},"RFC 2487"),'; and with developer friendly configuration settings, it makes it pretty easy to abide by the "newest" (2018) ',Object(r.b)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc8314"},"RFC 8314"),"."),Object(r.b)("p",null,"Eventually, it is up to ",Object(r.b)("em",{parentName:"p"},"you")," deciding exactly what kind of transportation/encryption to use and/or enforce, and to customize your instance accordingly (with looser or stricter security). Be also aware that protocols and ports on your server can only go so far with security; third-party MTAs might relay your emails on insecure connections, man-in-the-middle attacks might still prove effective, etc. Advanced counter-measure such as DANE, MTA-STS and/or full body encryption (eg. PGP) should be considered as well for increased confidentiality, but ideally without compromising backwards compatibility so as to not block emails."),Object(r.b)("p",null,"The ",Object(r.b)("a",{parentName:"p",href:"https://github.com/tomav/docker-mailserver"},"README")," is the best starting point in configuring and running your mail server. You may then explore this wiki to cover additional topics, including but not limited to, security."))}p.isMDXComponent=!0},125:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return u}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=i.a.createContext({}),p=function(e){var t=i.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=p(e.components);return i.a.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},d=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),b=p(n),d=a,u=b["".concat(o,".").concat(d)]||b[d]||m[d]||r;return n?i.a.createElement(u,s(s({ref:t},c),{},{components:n})):i.a.createElement(u,s({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);